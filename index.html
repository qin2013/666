<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>星烁游戏推广系统 - 快手账号推广赚钱平台</title>
    <style>
        :root {
            --primary-color: #ff6b00;
            --secondary-color: #ff3b00;
            --light-bg: #fff8f0;
            --card-bg: #ffffff;
            --text-color: #333333;
            --light-text: #999999;
            --border-color: #ffe0cc;
        }
        
        body {
            font-family: 'PingFang SC', 'Helvetica Neue', Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--light-bg);
            color: var(--text-color);
            line-height: 1.6;
        }
        
        .container {
            max-width: 100%;
            padding: 15px;
            padding-bottom: 70px;
        }
        
        header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 20px 0;
            text-align: center;
            border-radius: 0 0 15px 15px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            position: relative;
        }
        
        h1 {
            margin: 0;
            font-size: 22px;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.2);
        }
        
        .user-header {
            position: absolute;
            right: 15px;
            top: 15px;
            display: flex;
            align-items: center;
        }
        
        .user-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: rgba(255,255,255,0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-left: 10px;
            color: white;
            font-weight: bold;
            cursor: pointer;
        }
        
        .tab-bar {
            display: flex;
            background: white;
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
            z-index: 100;
        }
        
        .tab-item {
            flex: 1;
            text-align: center;
            padding: 12px 0;
            color: var(--light-text);
            font-size: 14px;
        }
        
        .tab-item.active {
            color: var(--primary-color);
            font-weight: bold;
        }
        
        .tab-item i {
            display: block;
            font-size: 20px;
            margin-bottom: 4px;
        }
        
        .banner {
            background: linear-gradient(135deg, var(--secondary-color), #ff1a00);
            color: white;
            padding: 12px 15px;
            border-radius: 8px;
            margin: 15px 0;
            text-align: center;
            font-weight: bold;
            font-size: 16px;
            box-shadow: 0 4px 8px rgba(255, 59, 0, 0.3);
        }
        
        .card {
            background: var(--card-bg);
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            border: 1px solid var(--border-color);
        }
        
        .money-card {
            background: linear-gradient(135deg, #fff4e6, #ffebcc);
            border-left: 4px solid var(--primary-color);
        }
        
        .highlight {
            color: var(--secondary-color);
            font-weight: bold;
        }
        
        .big-money {
            font-size: 24px;
            color: #ff1a00;
            font-weight: bold;
            text-align: center;
            margin: 10px 0;
        }
        
        .btn {
            display: block;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            text-align: center;
            padding: 12px;
            border-radius: 25px;
            margin: 20px 0;
            text-decoration: none;
            font-weight: bold;
            box-shadow: 0 4px 12px rgba(255, 107, 0, 0.3);
            border: none;
            width: 100%;
            font-size: 16px;
            cursor: pointer;
        }
        
        .steps {
            margin: 20px 0;
        }
        
        .step {
            display: flex;
            margin-bottom: 15px;
            align-items: center;
        }
        
        .step-num {
            background: var(--primary-color);
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            text-align: center;
            line-height: 24px;
            margin-right: 10px;
            flex-shrink: 0;
        }
        
        .user-list {
            margin: 15px 0;
        }
        
        .user-item {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px dashed #ffd9cc;
        }
        
        .user-avatar-small {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #ffebcc;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 10px;
            color: var(--primary-color);
            font-weight: bold;
        }
        
        .user-info {
            flex-grow: 1;
        }
        
        .user-earnings {
            color: var(--secondary-color);
            font-weight: bold;
            white-space: nowrap;
        }
        
        footer {
            text-align: center;
            padding: 15px;
            color: var(--light-text);
            font-size: 12px;
            margin-top: 20px;
        }
        
        .price-list {
            margin: 15px 0;
        }
        
        .price-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #ffe6d6;
        }
        
        .qr-code {
            text-align: center;
            margin: 20px 0;
        }
        
        .qr-code img {
            width: 150px;
            height: 150px;
            border: 1px solid #eee;
            padding: 5px;
            background: white;
        }
        
        /* 图片预览 */
        .proof-preview {
            max-width: 100%;
            max-height: 200px;
            margin-top: 10px;
            border-radius: 5px;
            display: none;
        }
        
        /* 音乐控制 */
        .music-control {
            position: fixed;
            top: 10px;
            left: 10px;
            z-index: 1000;
            background: rgba(255,255,255,0.8);
            padding: 5px;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        
        /* 规则介绍样式 */
        .rules-container {
            margin: 15px 0;
        }
        
        .rule-item {
            margin-bottom: 10px;
            padding-left: 15px;
            position: relative;
        }
        
        .rule-item:before {
            content: "•";
            position: absolute;
            left: 0;
            color: var(--primary-color);
            font-weight: bold;
        }
        
        /* 任务提交表单 */
        .task-form {
            margin-top: 15px;
        }
        
        .task-proof-container {
            margin-top: 10px;
        }
        
        .task-proof-required {
            color: red;
            font-size: 12px;
            margin-left: 5px;
        }
        
        /* 统计信息 */
        .stats-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 15px 0;
        }
        
        .stat-card {
            flex: 1;
            min-width: 120px;
            background: white;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: var(--primary-color);
            margin: 5px 0;
        }
        
        .stat-label {
            font-size: 12px;
            color: var(--light-text);
        }
        
        /* 提现记录 */
        .withdraw-item {
            padding: 10px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
        }
        
        .withdraw-status {
            padding: 3px 8px;
            border-radius: 3px;
            font-size: 12px;
        }
        
        .status-pending {
            background: #fff3cd;
            color: #856404;
        }
        
        .status-success {
            background: #d4edda;
            color: #155724;
        }
        
        .status-failed {
            background: #f8d7da;
            color: #721c24;
        }
        
        /* QQ群提醒 */
        .qq-group-notice {
            background: #f8f9fa;
            border-left: 4px solid #17a2b8;
            padding: 10px;
            margin: 15px 0;
            border-radius: 0 5px 5px 0;
        }
        
        /* 用户须知弹窗 */
        .notice-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.7);
            z-index: 1002;
            justify-content: center;
            align-items: center;
        }
        
        .notice-content {
            background: white;
            border-radius: 10px;
            width: 90%;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
            padding: 20px;
            animation: fadeIn 0.3s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .notice-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 15px;
            color: var(--primary-color);
            text-align: center;
        }
        
        .notice-item {
            margin-bottom: 10px;
            padding-left: 15px;
            position: relative;
        }
        
        .notice-item:before {
            content: "•";
            position: absolute;
            left: 0;
            color: var(--primary-color);
            font-weight: bold;
        }
        
        .notice-confirm-btn {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            margin-top: 20px;
            width: 100%;
            font-weight: bold;
            cursor: pointer;
        }
        
        /* 图片上传区域 */
        .upload-area {
            border: 2px dashed #ffd9cc;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            margin-bottom: 10px;
            transition: all 0.3s;
        }
        
        .upload-area:hover {
            border-color: var(--primary-color);
            background: #fff8f0;
        }
        
        .upload-area i {
            font-size: 40px;
            color: var(--primary-color);
            margin-bottom: 10px;
        }
        
        .upload-text {
            font-size: 14px;
            color: var(--light-text);
        }
        
        /* 任务记录样式 */
        .task-item {
            padding: 10px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        /* 审核状态标签 */
        .status-label {
            padding: 2px 8px;
            border-radius: 3px;
            font-size: 12px;
            display: inline-block;
        }
        
        .status-pending {
            background: #fff3cd;
            color: #856404;
        }
        
        .status-approved {
            background: #d4edda;
            color: #155724;
        }
        
        .status-rejected {
            background: #f8d7da;
            color: #721c24;
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
</head>
<body>
    <!-- 用户须知弹窗 -->
    <div class="notice-modal" id="notice-modal">
        <div class="notice-content">
            <div class="notice-title"><i class="fas fa-exclamation-circle"></i> 用户须知</div>
            <div class="notice-item">请确保您上传的截图清晰可见，包含完整的快手关注或游戏下载界面</div>
            <div class="notice-item">同一设备和快手天内只能完成一次下载任务，请勿重复提交否则账号封禁处理</div>
            <div class="notice-item">每月1号和16提现，提现需联系QQ: 3965723380</div>
            <div class="notice-item">禁止使用任何作弊手段，违规者将封号处理</div>
            <div class="notice-item">推广时请遵守平台规则，不得发布违规内容</div>
            <div class="notice-item">每日推广人数无上限，多劳多得</div>
            <div class="notice-item">如有疑问，请及时联系客服QQ: 3965723380</div>
            <button class="notice-confirm-btn" onclick="hideNotice()">我已阅读并同意</button>
        </div>
    </div>
    
    <!-- 音乐控制按钮 -->
    <div class="music-control" id="music-control" onclick="toggleMusic()">
        <i class="fas fa-music"></i>
    </div>
    
    <!-- 背景音乐 - 轻音乐版本 -->
    <audio id="bg-music" loop>
        <source src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-9.mp3" type="audio/mpeg">
    </audio>
    
    <!-- 点击音效 -->
    <audio id="click-sound">
        <source src="https://www.soundjay.com/buttons/sounds/button-09.mp3" type="audio/mpeg">
    </audio>
    
    <header>
        <div class="container">
            <h1>星烁游戏推广系统</h1>
            <p>快手账号推广赚钱平台</p>
            <div class="user-header">
                <span id="username-display">未登录</span>
                <div class="user-avatar" id="user-avatar" onclick="toggleUserMenu()"><i class="fas fa-user"></i></div>
            </div>
        </div>
    </header>
    
    <div class="user-menu" id="user-menu" style="display: none; position: absolute; right: 15px; top: 70px; background: white; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.2); z-index: 1000; width: 150px;">
        <div style="padding: 10px; border-bottom: 1px solid #eee; cursor: pointer;" onclick="showLoginForm()"><i class="fas fa-sign-in-alt"></i> 用户登录</div>
        <div style="padding: 10px; cursor: pointer;" id="logout-btn" onclick="logout()"><i class="fas fa-sign-out-alt"></i> 退出登录</div>
    </div>
    
    <!-- 登录表单 -->
    <div id="login-modal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 1001; justify-content: center; align-items: center;">
        <div style="background: white; padding: 20px; border-radius: 10px; width: 90%; max-width: 400px;">
            <h2 style="margin-top: 0;">用户登录</h2>
            <div class="form-group">
                <label>手机号码</label>
                <input type="text" id="login-phone" class="form-control" placeholder="请输入手机号">
            </div>
            <div class="form-group">
                <label>验证码</label>
                <div style="display: flex;">
                    <input type="text" id="login-code" class="form-control" placeholder="请输入验证码" style="flex: 1;">
                    <button id="send-code-btn" style="margin-left: 10px; padding: 0 10px; background: var(--primary-color); color: white; border: none; border-radius: 5px; cursor: pointer;">获取验证码</button>
                </div>
            </div>
            <button class="btn" onclick="userLogin()">登录</button>
            <button style="margin-top: 10px; width: 100%; padding: 10px; background: #f0f0f0; border: none; border-radius: 5px; cursor: pointer;" onclick="hideLoginForm()">取消</button>
        </div>
    </div>
    
    <!-- 提现模态框 -->
    <div id="withdraw-modal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 1001; justify-content: center; align-items: center;">
        <div style="background: white; padding: 20px; border-radius: 10px; width: 90%; max-width: 400px;">
            <h2 style="margin-top: 0;">申请提现</h2>
            <div class="form-group">
                <label>提现金额</label>
                <input type="number" class="form-control" id="withdraw-amount" placeholder="请输入提现金额">
            </div>
            <div class="form-group">
                <label>提现方式</label>
                <select class="form-control" id="withdraw-method">
                    <option value="wechat">微信支付</option>
                    <option value="alipay">支付宝</option>
                </select>
            </div>
            <div class="form-group">
                <label>收款账号</label>
                <input type="text" class="form-control" id="withdraw-account" placeholder="请输入收款账号">
            </div>
            <div style="font-size: 12px; color: var(--light-text); margin-bottom: 15px;">
                提现需联系QQ: 3965723380 处理
            </div>
            <button class="btn" onclick="submitWithdraw()">提交提现申请</button>
            <button style="margin-top: 10px; width: 100%; padding: 10px; background: #f0f0f0; border: none; border-radius: 5px; cursor: pointer;" onclick="hideWithdrawModal()">取消</button>
        </div>
    </div>
    
    <!-- 主内容区域 -->
    <div class="container" id="main-content">
        <!-- QQ群提醒 -->
        <div class="qq-group-notice" id="qq-group-notice">
            <strong><i class="fas fa-info-circle"></i> 提现提醒：</strong>提现请添加QQ群主: <span class="highlight">3965723380</span> 联系处理。
        </div>
        
        <!-- 首页 -->
        <div id="home-tab">
            <div class="banner">
                🎉 今日已有<span id="today-users">218</span>人参与，最高赚¥<span id="max-earnings">386</span>！立即加入！ 🎉
            </div>
            
            <div class="card money-card">
                <div class="big-money">关注=0.1元 &nbsp; 下载=5元</div>
                <div style="text-align: center;">每推广1人下载游戏，立得5元现金奖励！</div>
            </div>
            
            <div class="card">
                <h2><i class="fas fa-money-bill-wave"></i> 收益明细</h2>
                <div class="price-list">
                    <div class="price-item">
                        <span>快手账号关注</span>
                        <span class="highlight">+0.1元/人</span>
                    </div>
                    <div class="price-item">
                        <span>下载安装游戏</span>
                        <span class="highlight">+5元/人</span>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <h2><i class="fas fa-mobile-alt"></i> 如何参与？</h2>
                <div class="steps">
                    <div class="step">
                        <div class="step-num">1</div>
                        <div>关注【星烁游戏】快手号: 4713343918</div>
                    </div>
                    <div class="step">
                        <div class="step-num">2</div>
                        <div>转发指定作品给你的好友或群聊</div>
                    </div>
                    <div class="step">
                        <div class="step-num">3</div>
                        <div>好友完成关注/下载后，系统自动结算</div>
                    </div>
                </div>
                
                <h3 style="margin-top: 20px;">推广作品链接</h3>
                <div style="background: #f9f9f9; padding: 10px; border-radius: 5px; margin-top: 10px;">
                    <p><a href="https://v.kuaishou.com/2C2bXWB" target="_blank">https://v.kuaishou.com/2C2bXWB</a></p>
                    <p><a href="https://v.kuaishou.com/2B3koRE" target="_blank">https://v.kuaishou.com/2B3koRE</a></p>
                    <p><a href="https://v.kuaishou.com/2AKRu3o" target="_blank">https://v.kuaishou.com/2AKRu3o</a></p>
                    <p><a href="https://v.kuaishou.com/2CaQ8T7" target="_blank">https://v.kuaishou.com/2CaQ8T7</a></p>
                </div>
            </div>
            
            <div class="card">
                <h2><i class="fas fa-trophy"></i> 今日赚钱榜</h2>
                <div class="user-list" id="earnings-leaderboard">
                    <!-- 动态生成赚钱榜 -->
                </div>
            </div>
            
            <div class="card">
                <h2><i class="fas fa-lightbulb"></i> 推广技巧</h2>
                <ul>
                    <li>分享到微信群、朋友圈，附上你的专属邀请码</li>
                    <li>告诉好友"关注就有钱，下载赚5元"</li>
                    <li>每天坚持推广3小时，月入3000+很轻松</li>
                    <li>组建团队，获得下级20%收益分成</li>
                </ul>
            </div>
            
            <div class="card">
                <h2><i class="fas fa-info-circle"></i> 活动规则</h2>
                <div class="rules-container">
                    <div class="rule-item">收益满10元可提现，需联系QQ群主: 3965723380 处理</div>
                    <div class="rule-item">同一快手账号设备2天只能做一次下载任务</div>
                    <div class="rule-item">可以找朋友帮忙做任务，但必须使用不同的快手账号</div>
                    <div class="rule-item">提交关注任务需提供快手关注截图</div>
                    <div class="rule-item">提交游戏任务需提供5分钟以上的游玩记录截图</div>
                    <div class="rule-item">禁止刷量，违规者封号处理</div>
                    <div class="rule-item">活动截止时间：2027年6月4日</div>
                </div>
            </div>
            
            <button class="btn" onclick="switchTab('task')"><i class="fas fa-check-circle"></i> 提交任务审核</button>
        </div>
        
        <!-- 我的收益 -->
        <div id="earnings-tab" style="display: none;">
            <div class="card">
                <h2><i class="fas fa-wallet"></i> 我的钱包</h2>
                <div style="text-align: center; margin: 20px 0;">
                    <div style="font-size: 14px; color: var(--light-text);">可提现金额</div>
                    <div style="font-size: 36px; font-weight: bold; color: var(--primary-color);" id="withdrawable-amount">¥0.00</div>
                </div>
                
                <div class="stats-container">
                    <div class="stat-card">
                        <div class="stat-value" id="today-earnings">¥0</div>
                        <div class="stat-label">今日收益</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="month-earnings">¥0</div>
                        <div class="stat-label">本月收益</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="total-earnings">¥0</div>
                        <div class="stat-label">累计收益</div>
                    </div>
                </div>
                
                <button class="btn" onclick="showWithdrawModal()" id="withdraw-btn" disabled><i class="fas fa-money-bill-wave"></i> 申请提现</button>
                <div style="text-align: center; font-size: 12px; color: var(--light-text);">提现需联系QQ: 3965723380</div>
            </div>
            
            <div class="card">
                <h2><i class="fas fa-chart-line"></i> 收益明细</h2>
                <div id="earnings-details">
                    <div style="text-align: center; padding: 30px; color: var(--light-text);">
                        <i class="fas fa-wallet" style="font-size: 40px; margin-bottom: 10px;"></i>
                        <p>暂无收益记录</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 任务提交 -->
        <div id="task-tab" style="display: none;">
            <div class="card">
                <h2><i class="fas fa-tasks"></i> 提交推广任务</h2>
                <div class="task-form">
                    <div class="form-group">
                        <label>推广方式</label>
                        <select class="form-control" id="task-type">
                            <option value="follow">快手账号关注</option>
                            <option value="download">游戏下载</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>推广人数</label>
                        <input type="number" class="form-control" id="task-count" placeholder="请输入推广人数">
                    </div>
                    <div class="form-group">
                        <label>推广截图证明 <span class="task-proof-required">*必填</span></label>
                        <div class="task-proof-container">
                            <div class="upload-area" onclick="document.getElementById('task-proof').click()">
                                <i class="fas fa-cloud-upload-alt"></i>
                                <div class="upload-text">点击上传截图</div>
                                <div style="font-size: 12px; color: var(--light-text);" id="proof-requirement">请上传快手关注截图</div>
                            </div>
                            <input type="file" id="task-proof" accept="image/*" style="display: none;" onchange="previewProof()">
                            <img id="proof-preview" class="proof-preview" alt="截图预览">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>备注说明</label>
                        <textarea class="form-control" id="task-remark" rows="3" placeholder="可填写推广详情"></textarea>
                    </div>
                    <button class="btn" onclick="submitTask()"><i class="fas fa-paper-plane"></i> 提交审核</button>
                </div>
            </div>
            
            <div class="card">
                <h2><i class="fas fa-history"></i> 任务记录</h2>
                <div id="task-history">
                    <div style="text-align: center; padding: 30px; color: var(--light-text);">
                        <i class="fas fa-history" style="font-size: 40px; margin-bottom: 10px;"></i>
                        <p>暂无任务记录</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 底部导航栏 -->
    <div class="tab-bar">
        <div class="tab-item active" onclick="switchTab('home')">
            <i class="fas fa-home"></i>
            <span>首页</span>
        </div>
        <div class="tab-item" onclick="switchTab('earnings')">
            <i class="fas fa-wallet"></i>
            <span>我的收益</span>
        </div>
        <div class="tab-item" onclick="switchTab('task')">
            <i class="fas fa-tasks"></i>
            <span>任务提交</span>
        </div>
    </div>
    
    <footer>
        <p>温馨提示：收益因人而异，多劳多得</p>
        <p>© 2023-2027 星烁游戏推广平台 版权所有</p>
    </footer>

    <script>
        // 使用localStorage模拟数据库
        if (!localStorage.getItem('users')) {
            localStorage.setItem('users', JSON.stringify([]));
        }
        
        if (!localStorage.getItem('tasks')) {
            localStorage.setItem('tasks', JSON.stringify([
                { id: 1, type: 'follow', name: '快手账号关注', reward: 0.1, desc: '关注星烁游戏快手官方账号' },
                { id: 2, type: 'download', name: '下载安装游戏', reward: 5, desc: '下载并安装星烁游戏的指定游戏' }
            ]));
        }
        
        if (!localStorage.getItem('userTasks')) {
            localStorage.setItem('userTasks', JSON.stringify([]));
        }
        
        if (!localStorage.getItem('earnings')) {
            localStorage.setItem('earnings', JSON.stringify([]));
        }
        
        if (!localStorage.getItem('withdrawals')) {
            localStorage.setItem('withdrawals', JSON.stringify([]));
        }
        
        // 存储上传的图片哈希值
        if (!localStorage.getItem('imageHashes')) {
            localStorage.setItem('imageHashes', JSON.stringify([]));
        }
        
        // 当前用户状态
        let currentUser = null;
        
        // 音乐状态
        let isMusicPlaying = false;
        const bgMusic = document.getElementById('bg-music');
        const clickSound = document.getElementById('click-sound');
        
        // 随机中文名字生成
        const FIRST_NAMES = ['张', '李', '王', '刘', '陈', '杨', '赵', '黄', '周', '吴', '徐', '孙', '胡', '朱', '高', '林', '何', '郭', '马', '罗'];
        const LAST_NAMES = ['伟', '芳', '娜', '秀英', '敏', '静', '丽', '强', '磊', '军', '洋', '勇', '艳', '杰', '娟', '涛', '明', '超', '秀兰', '霞'];
        
        function generateRandomName() {
            const firstName = FIRST_NAMES[Math.floor(Math.random() * FIRST_NAMES.length)];
            const lastName = LAST_NAMES[Math.floor(Math.random() * LAST_NAMES.length)];
            return firstName + lastName;
        }
        
        // 播放点击音效
        function playClickSound() {
            clickSound.currentTime = 0;
            clickSound.play().catch(e => console.log('无法播放点击音效:', e));
        }
        
        // 切换音乐播放状态
        function toggleMusic() {
            playClickSound();
            if (isMusicPlaying) {
                bgMusic.pause();
                document.getElementById('music-control').innerHTML = '<i class="fas fa-music"></i>';
            } else {
                bgMusic.play().catch(e => console.log('无法播放背景音乐:', e));
                document.getElementById('music-control').innerHTML = '<i class="fas fa-pause"></i>';
            }
            isMusicPlaying = !isMusicPlaying;
        }
        
        // 显示用户须知
        function showNotice() {
            document.getElementById('notice-modal').style.display = 'flex';
        }
        
        // 隐藏用户须知
        function hideNotice() {
            playClickSound();
            document.getElementById('notice-modal').style.display = 'none';
            localStorage.setItem('noticeShown', 'true');
        }
        
        // 预览截图
        function previewProof() {
            const file = document.getElementById('task-proof').files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const preview = document.getElementById('proof-preview');
                    preview.src = e.target.result;
                    preview.style.display = 'block';
                    
                    // 更新上传区域显示
                    const uploadArea = document.querySelector('.upload-area');
                    uploadArea.innerHTML = `
                        <i class="fas fa-check-circle" style="color: green;"></i>
                        <div class="upload-text">截图已上传</div>
                        <div style="font-size: 12px; color: var(--light-text);">${file.name}</div>
                    `;
                }
                reader.readAsDataURL(file);
            }
        }
        
        // 更新截图要求提示
        function updateProofRequirement() {
            const taskType = document.getElementById('task-type').value;
            const requirementText = taskType === 'follow' 
                ? '请上传快手关注截图，需清晰显示关注状态' 
                : '请上传5分钟以上的游戏游玩记录截图，需显示游戏ID和时间';
            document.getElementById('proof-requirement').textContent = requirementText;
            
            // 重置上传区域显示
            const uploadArea = document.querySelector('.upload-area');
            uploadArea.innerHTML = `
                <i class="fas fa-cloud-upload-alt"></i>
                <div class="upload-text">点击上传截图</div>
                <div style="font-size: 12px; color: var(--light-text);">${requirementText}</div>
            `;
            
            // 隐藏预览
            document.getElementById('proof-preview').style.display = 'none';
        }
        
        // 计算图片的简单哈希值（模拟）
        async function calculateImageHash(file) {
            return new Promise((resolve) => {
                const reader = new FileReader();
                reader.onload = function(e) {
                    // 在实际应用中，这里应该使用更复杂的哈希算法
                    // 这里我们简单使用文件大小和部分数据作为哈希
                    const content = e.target.result;
                    const size = file.size;
                    const hash = size + '_' + content.length + '_' + content.slice(0, 20);
                    resolve(hash);
                };
                reader.readAsDataURL(file);
            });
        }
        
        // 检查图片是否重复
        async function checkDuplicateImage(file) {
            const hash = await calculateImageHash(file);
            const imageHashes = JSON.parse(localStorage.getItem('imageHashes'));
            
            if (imageHashes.includes(hash)) {
                return true; // 图片已存在
            }
            
            // 保存新图片的哈希
            imageHashes.push(hash);
            localStorage.setItem('imageHashes', JSON.stringify(imageHashes));
            return false;
        }
        
        // DOM加载完成后初始化
        document.addEventListener('DOMContentLoaded', function() {
            // 检查是否第一次访问，显示用户须知
            if (!localStorage.getItem('noticeShown')) {
                setTimeout(showNotice, 1000);
            }
            
            checkLoginStatus();
            updateStats();
            
            // 为所有按钮添加点击音效
            document.querySelectorAll('button, [onclick], .tab-item, .user-avatar').forEach(el => {
                el.addEventListener('click', playClickSound);
            });
            
            // 任务类型变化时更新截图要求
            document.getElementById('task-type').addEventListener('change', updateProofRequirement);
            
            // 初始化截图要求提示
            updateProofRequirement();
            
            // 尝试自动播放音乐
            bgMusic.volume = 0.3;
            const playPromise = bgMusic.play();
            
            if (playPromise !== undefined) {
                playPromise.then(_ => {
                    // 自动播放成功
                    isMusicPlaying = true;
                    document.getElementById('music-control').innerHTML = '<i class="fas fa-pause"></i>';
                })
                .catch(error => {
                    // 自动播放失败，等待用户交互
                    document.addEventListener('click', function firstInteraction() {
                        bgMusic.play().then(() => {
                            isMusicPlaying = true;
                            document.getElementById('music-control').innerHTML = '<i class="fas fa-pause"></i>';
                        }).catch(e => console.log('播放失败:', e));
                        document.removeEventListener('click', firstInteraction);
                    }, { once: true });
                });
            }
            
            // 保持音乐播放状态
            document.addEventListener('visibilitychange', function() {
                if (!document.hidden && isMusicPlaying) {
                    bgMusic.play().catch(e => console.log('恢复播放失败:', e));
                }
            });
            
            // 每5分钟刷新赚钱榜
            setInterval(updateEarningsLeaderboard, 5 * 60 * 1000);
            updateEarningsLeaderboard();
        });
        
        // 更新赚钱榜
        function updateEarningsLeaderboard() {
            const userTasks = JSON.parse(localStorage.getItem('userTasks'));
            const users = JSON.parse(localStorage.getItem('users'));
            
            // 获取今日完成的下载任务
            const todayDownloadTasks = userTasks.filter(t => 
                t.type === 'download' && 
                t.status === 'approved' &&
                new Date(t.submitTime).toDateString() === new Date().toDateString()
            );
            
            // 按用户分组统计
            const userEarnings = {};
            todayDownloadTasks.forEach(task => {
                if (!userEarnings[task.userId]) {
                    userEarnings[task.userId] = {
                        count: 0,
                        earnings: 0
                    };
                }
                userEarnings[task.userId].count += task.count;
                userEarnings[task.userId].earnings += task.reward;
            });
            
            // 转换为数组并排序
            let leaderboard = Object.entries(userEarnings)
                .map(([userId, data]) => ({
                    userId: parseInt(userId),
                    count: data.count,
                    earnings: data.earnings
                }))
                .sort((a, b) => b.earnings - a.earnings);
            
            // 如果没有真实用户数据，生成一些机器人数据
            if (leaderboard.length === 0) {
                leaderboard = [
                    { userId: -1, count: 86, earnings: 430, isBot: true, name: generateRandomName() },
                    { userId: -2, count: 52, earnings: 260, isBot: true, name: generateRandomName() },
                    { userId: -3, count: 38, earnings: 190, isBot: true, name: generateRandomName() }
                ];
            } else if (leaderboard.length < 3) {
                // 补充机器人数据
                const botCount = 3 - leaderboard.length;
                for (let i = 0; i < botCount; i++) {
                    leaderboard.push({
                        userId: -(i + 4),
                        count: Math.floor(Math.random() * 30) + 20,
                        earnings: Math.floor(Math.random() * 150) + 100,
                        isBot: true,
                        name: generateRandomName()
                    });
                }
                // 重新排序
                leaderboard.sort((a, b) => b.earnings - a.earnings);
            }
            
            // 只取前三名
            leaderboard = leaderboard.slice(0, 3);
            
            // 生成HTML
            let leaderboardHtml = '';
            
            leaderboard.forEach((item, index) => {
                const user = users.find(u => u.id === item.userId);
                let name, shortName;
                
                if (item.isBot) {
                    name = item.name;
                    shortName = name.length > 2 ? name.charAt(0) + '*' : name;
                } else {
                    name = user ? user.name : '匿名用户';
                    shortName = name.length > 2 ? name.charAt(0) + '*' : name;
                }
                
                // 随机生成时间
                const hoursAgo = 3 - index;
                const timeText = hoursAgo === 0 ? '30分钟前' : `${hoursAgo}小时前`;
                
                leaderboardHtml += `
                    <div class="user-item">
                        <div class="user-avatar-small">${shortName}</div>
                        <div class="user-info">
                            <div>推广${item.count}人下载</div>
                            <div style="font-size:12px;color:#999;">${timeText}</div>
                        </div>
                        <div class="user-earnings">+¥${item.earnings.toFixed(0)}</div>
                    </div>
                `;
            });
            
            document.getElementById('earnings-leaderboard').innerHTML = leaderboardHtml;
        }
        
        // 切换标签页
        function switchTab(tabName) {
            playClickSound();
            document.querySelectorAll('.tab-item').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.getElementById('home-tab').style.display = 'none';
            document.getElementById('earnings-tab').style.display = 'none';
            document.getElementById('task-tab').style.display = 'none';
            
            document.getElementById(tabName + '-tab').style.display = 'block';
            
            // 找到对应的tab按钮并激活
            const tabBtns = document.querySelectorAll('.tab-item');
            tabBtns.forEach(btn => {
                if (btn.textContent.includes(tabName === 'home' ? '首页' : 
                                           tabName === 'earnings' ? '收益' : '任务')) {
                    btn.classList.add('active');
                }
            });
            
            // 如果是收益或任务页，检查登录状态
            if ((tabName === 'earnings' || tabName === 'task') && !currentUser) {
                showLoginForm();
                switchTab('home');
            }
        }
        
        // 显示/隐藏用户菜单
        function toggleUserMenu() {
            const menu = document.getElementById('user-menu');
            if (menu.style.display === 'block') {
                menu.style.display = 'none';
            } else {
                menu.style.display = 'block';
            }
        }
        
        // 关闭所有弹出层
        function closeAllPopups() {
            document.getElementById('user-menu').style.display = 'none';
            document.getElementById('login-modal').style.display = 'none';
            document.getElementById('withdraw-modal').style.display = 'none';
        }
        
        // 点击页面其他地方关闭弹出层
        document.addEventListener('click', function(e) {
            if (!e.target.closest('#user-avatar') && !e.target.closest('#user-menu')) {
                document.getElementById('user-menu').style.display = 'none';
            }
        });
        
        // 显示登录表单
        function showLoginForm() {
            playClickSound();
            closeAllPopups();
            document.getElementById('login-modal').style.display = 'flex';
        }
        
        // 隐藏登录表单
        function hideLoginForm() {
            playClickSound();
            document.getElementById('login-modal').style.display = 'none';
        }
        
        // 显示提现模态框
        function showWithdrawModal() {
            playClickSound();
            if (!currentUser) {
                showLoginForm();
                return;
            }
            
            document.getElementById('withdraw-amount').value = '';
            document.getElementById('withdraw-account').value = '';
            document.getElementById('withdraw-modal').style.display = 'flex';
        }
        
        // 隐藏提现模态框
        function hideWithdrawModal() {
            playClickSound();
            document.getElementById('withdraw-modal').style.display = 'none';
        }
        
        // 发送验证码
        document.getElementById('send-code-btn').addEventListener('click', function() {
            playClickSound();
            const phone = document.getElementById('login-phone').value;
            if (!phone || !/^1[3-9]\d{9}$/.test(phone)) {
                alert('请输入正确的手机号码');
                return;
            }
            
            this.disabled = true;
            let countdown = 60;
            this.textContent = `${countdown}秒后重试`;
            
            const timer = setInterval(() => {
                countdown--;
                this.textContent = `${countdown}秒后重试`;
                
                if (countdown <= 0) {
                    clearInterval(timer);
                    this.disabled = false;
                    this.textContent = '获取验证码';
                }
            }, 1000);
            
            // 模拟发送验证码
            alert(`验证码已发送至 ${phone}，测试验证码为：123456`);
        });
        
        // 用户登录
        function userLogin() {
            playClickSound();
            const phone = document.getElementById('login-phone').value;
            const code = document.getElementById('login-code').value;
            
            if (!phone || !code) {
                alert('请输入手机号和验证码');
                return;
            }
            
            // 测试验证码为123456
            if (code !== '123456') {
                alert('验证码错误');
                return;
            }
            
            // 查找或创建用户
            const users = JSON.parse(localStorage.getItem('users'));
            let user = users.find(u => u.phone === phone);
            
            if (!user) {
                user = {
                    id: Date.now(),
                    phone: phone,
                    name: '用户' + phone.slice(-4),
                    registerTime: new Date().toISOString(),
                    earnings: 0,
                    withdrawable: 0,
                    lastTaskTime: {}
                };
                users.push(user);
                localStorage.setItem('users', JSON.stringify(users));
            }
            
            currentUser = user;
            
            updateUserDisplay();
            hideLoginForm();
            
            // 如果是第一次登录，显示欢迎消息
            if (!user.hasLoggedIn) {
                alert(`欢迎加入星烁游戏推广平台！您的邀请码是：${user.id}`);
                user.hasLoggedIn = true;
                localStorage.setItem('users', JSON.stringify(users));
            }
        }
        
        // 退出登录
        function logout() {
            playClickSound();
            currentUser = null;
            updateUserDisplay();
            switchTab('home');
        }
        
        // 检查登录状态
        function checkLoginStatus() {
            // 这里简化处理，实际应用中应该检查session或token
            if (currentUser) {
                updateUserDisplay();
            }
        }
        
        // 更新用户显示
        function updateUserDisplay() {
            if (currentUser) {
                document.getElementById('username-display').textContent = currentUser.name;
                document.getElementById('logout-btn').style.display = 'block';
                
                // 更新收益数据
                updateEarningsDisplay();
                updateTaskHistory();
            } else {
                document.getElementById('username-display').textContent = '未登录';
                document.getElementById('logout-btn').style.display = 'none';
            }
        }
        
        // 更新收益显示
        function updateEarningsDisplay() {
            if (!currentUser) return;
            
            const earnings = JSON.parse(localStorage.getItem('earnings'));
            const userEarnings = earnings.filter(e => e.userId === currentUser.id);
            
            // 计算各种收益
            const todayEarnings = userEarnings
                .filter(e => new Date(e.time).toDateString() === new Date().toDateString())
                .reduce((sum, e) => sum + e.amount, 0);
            
            const currentMonth = new Date().getMonth();
            const monthEarnings = userEarnings
                .filter(e => new Date(e.time).getMonth() === currentMonth)
                .reduce((sum, e) => sum + e.amount, 0);
            
            const totalEarnings = userEarnings.reduce((sum, e) => sum + e.amount, 0);
            
            document.getElementById('today-earnings').textContent = `¥${todayEarnings.toFixed(2)}`;
            document.getElementById('month-earnings').textContent = `¥${monthEarnings.toFixed(2)}`;
            document.getElementById('total-earnings').textContent = `¥${totalEarnings.toFixed(2)}`;
            document.getElementById('withdrawable-amount').textContent = `¥${currentUser.withdrawable.toFixed(2)}`;
            
            // 更新提现按钮状态
            document.getElementById('withdraw-btn').disabled = currentUser.withdrawable < 10;
            
            // 更新收益明细
            updateEarningsDetails();
        }
        
        // 更新收益明细
        function updateEarningsDetails() {
            const earnings = JSON.parse(localStorage.getItem('earnings'));
            const userEarnings = earnings.filter(e => e.userId === currentUser.id);
            
            if (userEarnings.length === 0) {
                document.getElementById('earnings-details').innerHTML = `
                    <div style="text-align: center; padding: 30px; color: var(--light-text);">
                        <i class="fas fa-wallet" style="font-size: 40px; margin-bottom: 10px;"></i>
                        <p>暂无收益记录</p>
                    </div>
                `;
                return;
            }
            
            const detailsHtml = userEarnings.map(e => `
                <div class="price-item">
                    <div>
                        <div>${e.type === 'follow' ? '快手账号关注' : 
                              e.type === 'download' ? '游戏下载' : '未知任务'}</div>
                        <div style="font-size:12px;color:#999;">${new Date(e.time).toLocaleString()}</div>
                    </div>
                    <div class="highlight">+¥${e.amount.toFixed(2)}</div>
                </div>
            `).join('');
            
            document.getElementById('earnings-details').innerHTML = detailsHtml;
        }
        
        // 提交任务
        async function submitTask() {
            playClickSound();
            if (!currentUser) {
                showLoginForm();
                return;
            }
            
            const type = document.getElementById('task-type').value;
            const count = parseInt(document.getElementById('task-count').value);
            const proof = document.getElementById('task-proof').files[0];
            const remark = document.getElementById('task-remark').value;
            
            if (!count || count <= 0) {
                alert('请输入有效的推广人数');
                return;
            }
            
            if (!proof) {
                alert('请上传推广截图证明');
                return;
            }
            
            // 检查图片是否重复
            const isDuplicate = await checkDuplicateImage(proof);
            if (isDuplicate) {
                alert('任务审核未通过：检测到重复使用相同的截图');
                return;
            }
            
            // 获取任务奖励标准
            const tasks = JSON.parse(localStorage.getItem('tasks'));
            const task = tasks.find(t => t.type === type);
            
            if (!task) {
                alert('任务类型错误');
                return;
            }
            
            // 创建用户任务记录
            const userTasks = JSON.parse(localStorage.getItem('userTasks'));
            const newTask = {
                id: Date.now(),
                userId: currentUser.id,
                taskId: task.id,
                type: task.type,
                count: count,
                status: 'pending',
                proof: '已上传', // 实际应用中应该上传到服务器
                remark: remark,
                submitTime: new Date().toISOString(),
                reward: task.reward * count
            };
            
            userTasks.push(newTask);
            localStorage.setItem('userTasks', JSON.stringify(userTasks));
            
            // 更新用户最后任务时间
            const users = JSON.parse(localStorage.getItem('users'));
            const user = users.find(u => u.id === currentUser.id);
            if (user) {
                if (!user.lastTaskTime) user.lastTaskTime = {};
                user.lastTaskTime[type] = new Date().toISOString();
                localStorage.setItem('users', JSON.stringify(users));
                currentUser.lastTaskTime = user.lastTaskTime;
            }
            
            // 清空表单
            document.getElementById('task-count').value = '';
            document.getElementById('task-proof').value = '';
            document.getElementById('proof-preview').style.display = 'none';
            document.getElementById('task-remark').value = '';
            
            // 重置上传区域显示
            const uploadArea = document.querySelector('.upload-area');
            uploadArea.innerHTML = `
                <i class="fas fa-cloud-upload-alt"></i>
                <div class="upload-text">点击上传截图</div>
                <div style="font-size: 12px; color: var(--light-text);" id="proof-requirement">${type === 'follow' ? '请上传快手关注截图' : '请上传游戏游玩记录截图'}</div>
            `;
            
            // 自动审核任务
            setTimeout(() => {
                // 模拟检查图片内容
                const isValidImage = Math.random() < 0.8; // 80%概率通过
                
                if (isValidImage) {
                    // 审核通过
                    const earnings = JSON.parse(localStorage.getItem('earnings'));
                    earnings.push({
                        id: Date.now(),
                        userId: currentUser.id,
                        type: type,
                        amount: task.reward * count,
                        time: new Date().toISOString(),
                        taskId: newTask.id
                    });
                    
                    localStorage.setItem('earnings', JSON.stringify(earnings));
                    
                    // 更新用户可提现余额
                    const users = JSON.parse(localStorage.getItem('users'));
                    const user = users.find(u => u.id === currentUser.id);
                    if (user) {
                        user.withdrawable += task.reward * count;
                        localStorage.setItem('users', JSON.stringify(users));
                        currentUser.withdrawable = user.withdrawable;
                        updateUserDisplay();
                    }
                    
                    // 更新任务状态
                    newTask.status = 'approved';
                    newTask.reviewTime = new Date().toISOString();
                    localStorage.setItem('userTasks', JSON.stringify(userTasks));
                    
                    alert('任务已自动审核通过！');
                } else {
                    // 审核不通过
                    newTask.status = 'rejected';
                    newTask.reviewTime = new Date().toISOString();
                    localStorage.setItem('userTasks', JSON.stringify(userTasks));
                    
                    alert('任务审核未通过：截图与任务不符');
                }
                
                // 更新任务历史
                updateTaskHistory();
                // 更新赚钱榜
                updateEarningsLeaderboard();
            }, 1000);
        }
        
        // 更新任务历史
        function updateTaskHistory() {
            if (!currentUser) return;
            
            const userTasks = JSON.parse(localStorage.getItem('userTasks'));
            const tasks = JSON.parse(localStorage.getItem('tasks'));
            
            const userTaskHistory = userTasks
                .filter(t => t.userId === currentUser.id)
                .map(t => {
                    const task = tasks.find(task => task.id === t.taskId);
                    return {
                        ...t,
                        taskName: task ? task.name : '未知任务'
                    };
                })
                .sort((a, b) => new Date(b.submitTime) - new Date(a.submitTime));
            
            if (userTaskHistory.length === 0) {
                document.getElementById('task-history').innerHTML = `
                    <div style="text-align: center; padding: 30px; color: var(--light-text);">
                        <i class="fas fa-history" style="font-size: 40px; margin-bottom: 10px;"></i>
                        <p>暂无任务记录</p>
                    </div>
                `;
                return;
            }
            
            const historyHtml = userTaskHistory.map(t => `
                <div class="task-item">
                    <div>
                        <div><strong>${t.taskName}</strong> × ${t.count}</div>
                        <div style="font-size:12px;color:#999;">${new Date(t.submitTime).toLocaleString()}</div>
                        <div style="font-size:12px;">
                            状态: <span class="status-label ${'status-' + t.status}">${
                                t.status === 'approved' ? '已通过' : 
                                t.status === 'rejected' ? '已拒绝' : '待审核'
                            }</span>
                        </div>
                    </div>
                    <div class="user-earnings">¥${t.reward.toFixed(2)}</div>
                </div>
            `).join('');
            
            document.getElementById('task-history').innerHTML = historyHtml;
        }
        
        // 提交提现申请
        function submitWithdraw() {
            playClickSound();
            const amount = parseFloat(document.getElementById('withdraw-amount').value);
            const method = document.getElementById('withdraw-method').value;
            const account = document.getElementById('withdraw-account').value;
            
            if (!amount || amount <= 0 || !account) {
                alert('请输入有效的提现金额和收款账号');
                return;
            }
            
            if (amount > currentUser.withdrawable) {
                alert('提现金额不能超过可提现余额');
                return;
            }
            
            if (amount < 10) {
                alert('最低提现金额为10元');
                return;
            }
            
            // 创建提现记录
            const withdrawals = JSON.parse(localStorage.getItem('withdrawals'));
            const newWithdrawal = {
                id: Date.now(),
                userId: currentUser.id,
                amount: amount,
                method: method,
                account: account,
                status: 'pending',
                applyTime: new Date().toISOString(),
                fee: amount * 0.02,
                contactQQ: '3965723380'
            };
            
            withdrawals.push(newWithdrawal);
            localStorage.setItem('withdrawals', JSON.stringify(withdrawals));
            
            // 更新用户可提现余额
            const users = JSON.parse(localStorage.getItem('users'));
            const user = users.find(u => u.id === currentUser.id);
            if (user) {
                user.withdrawable -= amount;
                localStorage.setItem('users', JSON.stringify(users));
                currentUser.withdrawable = user.withdrawable;
                updateUserDisplay();
            }
            
            alert('提现申请已提交，请添加QQ: 3965723380 联系处理');
            hideWithdrawModal();
        }
        
        // 更新统计数据
        function updateStats() {
            // 模拟更新今日参与人数和最高收益
            document.getElementById('today-users').textContent = Math.floor(Math.random() * 100) + 200;
            document.getElementById('max-earnings').textContent = Math.floor(Math.random() * 200) + 200;
        }
    </script>
</body>
</html>
