<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ˜Ÿçƒæ¸¸æˆæ¨å¹¿ç³»ç»Ÿ - å¿«æ‰‹è´¦å·æ¨å¹¿èµšé’±å¹³å°</title>
    <!-- æ·»åŠ Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <style>
        :root {
            --primary-color: #ff6b00;
            --secondary-color: #ff3b00;
            --light-bg: #fff8f0;
            --card-bg: #ffffff;
            --text-color: #333333;
            --light-text: #999999;
            --border-color: #ffe0cc;
        }
        
        body {
            font-family: 'PingFang SC', 'Helvetica Neue', Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--light-bg);
            color: var(--text-color);
            line-height: 1.6;
        }
        
        .container {
            max-width: 100%;
            padding: 15px;
            padding-bottom: 70px;
        }
        
        header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 20px 0;
            text-align: center;
            border-radius: 0 0 15px 15px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            position: relative;
        }
        
        h1 {
            margin: 0;
            font-size: 22px;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.2);
        }
        
        .user-header {
            position: absolute;
            right: 15px;
            top: 15px;
            display: flex;
            align-items: center;
        }
        
        .user-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: rgba(255,255,255,0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-left: 10px;
            color: white;
            font-weight: bold;
            cursor: pointer;
        }
        
        .tab-bar {
            display: flex;
            background: white;
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
            z-index: 100;
        }
        
        .tab-item {
            flex: 1;
            text-align: center;
            padding: 12px 0;
            color: var(--light-text);
            font-size: 14px;
        }
        
        .tab-item.active {
            color: var(--primary-color);
            font-weight: bold;
        }
        
        .tab-item i {
            display: block;
            font-size: 20px;
            margin-bottom: 4px;
        }
        
        .banner {
            background: linear-gradient(135deg, var(--secondary-color), #ff1a00);
            color: white;
            padding: 12px 15px;
            border-radius: 8px;
            margin: 15px 0;
            text-align: center;
            font-weight: bold;
            font-size: 16px;
            box-shadow: 0 4px 8px rgba(255, 59, 0, 0.3);
        }
        
        .card {
            background: var(--card-bg);
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            border: 1px solid var(--border-color);
        }
        
        .money-card {
            background: linear-gradient(135deg, #fff4e6, #ffebcc);
            border-left: 4px solid var(--primary-color);
        }
        
        .highlight {
            color: var(--secondary-color);
            font-weight: bold;
        }
        
        .big-money {
            font-size: 24px;
            color: #ff1a00;
            font-weight: bold;
            text-align: center;
            margin: 10px 0;
        }
        
        .btn {
            display: block;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            text-align: center;
            padding: 12px;
            border-radius: 25px;
            margin: 20px 0;
            text-decoration: none;
            font-weight: bold;
            box-shadow: 0 4px 12px rgba(255, 107, 0, 0.3);
            border: none;
            width: 100%;
            font-size: 16px;
            cursor: pointer;
        }
        
        .steps {
            margin: 20px 0;
        }
        
        .step {
            display: flex;
            margin-bottom: 15px;
            align-items: center;
        }
        
        .step-num {
            background: var(--primary-color);
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            text-align: center;
            line-height: 24px;
            margin-right: 10px;
            flex-shrink: 0;
        }
        
        .user-list {
            margin: 15px 0;
        }
        
        .user-item {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px dashed #ffd9cc;
        }
        
        .user-avatar-small {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #ffebcc;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 10px;
            color: var(--primary-color);
            font-weight: bold;
        }
        
        .user-info {
            flex-grow: 1;
        }
        
        .user-earnings {
            color: var(--secondary-color);
            font-weight: bold;
            white-space: nowrap;
        }
        
        footer {
            text-align: center;
            padding: 15px;
            color: var(--light-text);
            font-size: 12px;
            margin-top: 20px;
        }
        
        .price-list {
            margin: 15px 0;
        }
        
        .price-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #ffe6d6;
        }
        
        .qr-code {
            text-align: center;
            margin: 20px 0;
        }
        
        .qr-code img {
            width: 150px;
            height: 150px;
            border: 1px solid #eee;
            padding: 5px;
            background: white;
        }
        
        /* ç®¡ç†å‘˜æ ·å¼ */
        .admin-panel {
            display: none;
        }
        
        .admin-controls {
            margin-top: 15px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        
        .form-control {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            font-size: 16px;
        }
        
        .task-list {
            margin-top: 15px;
        }
        
        .task-item {
            padding: 10px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .task-actions button {
            margin-left: 5px;
            padding: 5px 10px;
            border: none;
            border-radius: 3px;
            cursor: pointer;
        }
        
        .edit-btn {
            background: var(--primary-color);
            color: white;
        }
        
        .delete-btn {
            background: #ff3333;
            color: white;
        }
        
        /* ç»Ÿè®¡ä¿¡æ¯ */
        .stats-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 15px 0;
        }
        
        .stat-card {
            flex: 1;
            min-width: 120px;
            background: white;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: var(--primary-color);
            margin: 5px 0;
        }
        
        .stat-label {
            font-size: 12px;
            color: var(--light-text);
        }
        
        /* æç°è®°å½• */
        .withdraw-item {
            padding: 10px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
        }
        
        .withdraw-status {
            padding: 3px 8px;
            border-radius: 3px;
            font-size: 12px;
        }
        
        .status-pending {
            background: #fff3cd;
            color: #856404;
        }
        
        .status-success {
            background: #d4edda;
            color: #155724;
        }
        
        .status-failed {
            background: #f8d7da;
            color: #721c24;
        }
        
        /* æ•°æ®è¡¨æ ¼ */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        
        .data-table th, .data-table td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }
        
        .data-table th {
            background-color: #ffebcc;
            font-weight: bold;
        }
        
        .data-table tr:hover {
            background-color: #fff4e6;
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
</head>
<body>
    <header>
        <div class="container">
            <h1>æ˜Ÿçƒæ¸¸æˆæ¨å¹¿ç³»ç»Ÿ</h1>
            <p>å¿«æ‰‹è´¦å·æ¨å¹¿èµšé’±å¹³å°</p>
            <div class="user-header">
                <span id="username-display">æœªç™»å½•</span>
                <div class="user-avatar" id="user-avatar" onclick="toggleUserMenu()"><i class="fas fa-user"></i></div>
            </div>
        </div>
    </header>
    
    <div class="user-menu" id="user-menu" style="display: none; position: absolute; right: 15px; top: 70px; background: white; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.2); z-index: 1000; width: 150px;">
        <div style="padding: 10px; border-bottom: 1px solid #eee; cursor: pointer;" onclick="showLoginForm()"><i class="fas fa-sign-in-alt"></i> ç”¨æˆ·ç™»å½•</div>
        <div style="padding: 10px; border-bottom: 1px solid #eee; cursor: pointer;" onclick="showAdminLogin()"><i class="fas fa-lock"></i> ç®¡ç†å‘˜ç™»å½•</div>
        <div style="padding: 10px; cursor: pointer; display: none;" id="logout-btn" onclick="logout()"><i class="fas fa-sign-out-alt"></i> é€€å‡ºç™»å½•</div>
    </div>
    
    <!-- ç™»å½•è¡¨å• -->
    <div id="login-modal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 1001; justify-content: center; align-items: center;">
        <div style="background: white; padding: 20px; border-radius: 10px; width: 90%; max-width: 400px;">
            <h2 style="margin-top: 0;">ç”¨æˆ·ç™»å½•</h2>
            <div class="form-group">
                <label>æ‰‹æœºå·ç </label>
                <input type="text" id="login-phone" class="form-control" placeholder="è¯·è¾“å…¥æ‰‹æœºå·">
            </div>
            <div class="form-group">
                <label>éªŒè¯ç </label>
                <div style="display: flex;">
                    <input type="text" id="login-code" class="form-control" placeholder="è¯·è¾“å…¥éªŒè¯ç " style="flex: 1;">
                    <button id="send-code-btn" style="margin-left: 10px; padding: 0 10px; background: var(--primary-color); color: white; border: none; border-radius: 5px; cursor: pointer;">è·å–éªŒè¯ç </button>
                </div>
            </div>
            <button class="btn" onclick="userLogin()">ç™»å½•</button>
            <button style="margin-top: 10px; width: 100%; padding: 10px; background: #f0f0f0; border: none; border-radius: 5px; cursor: pointer;" onclick="hideLoginForm()">å–æ¶ˆ</button>
        </div>
    </div>
    
    <!-- ç®¡ç†å‘˜ç™»å½•è¡¨å• -->
    <div id="admin-login-modal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 1001; justify-content: center; align-items: center;">
        <div style="background: white; padding: 20px; border-radius: 10px; width: 90%; max-width: 400px;">
            <h2 style="margin-top: 0;">ç®¡ç†å‘˜ç™»å½•</h2>
            <div class="form-group">
                <label>ç®¡ç†å‘˜è´¦å·</label>
                <input type="text" id="admin-username" class="form-control" placeholder="è¯·è¾“å…¥ç®¡ç†å‘˜è´¦å·">
            </div>
            <div class="form-group">
                <label>å¯†ç </label>
                <input type="password" id="admin-password" class="form-control" placeholder="è¯·è¾“å…¥å¯†ç ">
            </div>
            <button class="btn" onclick="adminLogin()">ç™»å½•</button>
            <button style="margin-top: 10px; width: 100%; padding: 10px; background: #f0f0f0; border: none; border-radius: 5px; cursor: pointer;" onclick="hideAdminLogin()">å–æ¶ˆ</button>
        </div>
    </div>
    
    <!-- ä¸»å†…å®¹åŒºåŸŸ -->
    <div class="container" id="main-content">
        <!-- é¦–é¡µ -->
        <div id="home-tab">
            <div class="banner">
                ğŸ‰ ä»Šæ—¥å·²æœ‰<span id="today-users">218</span>äººå‚ä¸ï¼Œæœ€é«˜èµšÂ¥<span id="max-earnings">386</span>ï¼ç«‹å³åŠ å…¥ï¼ ğŸ‰
            </div>
            
            <div class="card money-card">
                <div class="big-money">å…³æ³¨=0.1å…ƒ &nbsp; ä¸‹è½½=5å…ƒ</div>
                <div style="text-align: center;">æ¯æ¨å¹¿1äººä¸‹è½½æ¸¸æˆï¼Œç«‹å¾—5å…ƒç°é‡‘å¥–åŠ±ï¼</div>
            </div>
            
            <div class="card">
                <h2><i class="fas fa-money-bill-wave"></i> æ”¶ç›Šæ˜ç»†</h2>
                <div class="price-list">
                    <div class="price-item">
                        <span>å¿«æ‰‹è´¦å·å…³æ³¨</span>
                        <span class="highlight">+0.1å…ƒ/äºº</span>
                    </div>
                    <div class="price-item">
                        <span>è§‚çœ‹å®Œæ•´è§†é¢‘</span>
                        <span class="highlight">+0.5å…ƒ/äºº</span>
                    </div>
                    <div class="price-item">
                        <span>ä¸‹è½½å®‰è£…æ¸¸æˆ</span>
                        <span class="highlight">+5å…ƒ/äºº</span>
                    </div>
                    <div class="price-item">
                        <span>æ¸¸æˆè¯•ç©10åˆ†é’Ÿ</span>
                        <span class="highlight">+3å…ƒ/äºº</span>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <h2><i class="fas fa-mobile-alt"></i> å¦‚ä½•å‚ä¸ï¼Ÿ</h2>
                <div class="steps">
                    <div class="step">
                        <div class="step-num">1</div>
                        <div>æ‰«æä¸‹æ–¹äºŒç»´ç å…³æ³¨ã€æ˜Ÿçƒæ¸¸æˆã€‘å¿«æ‰‹å·</div>
                    </div>
                    <div class="step">
                        <div class="step-num">2</div>
                        <div>è½¬å‘æŒ‡å®šä½œå“ç»™ä½ çš„å¥½å‹æˆ–ç¾¤èŠ</div>
                    </div>
                    <div class="step">
                        <div class="step-num">3</div>
                        <div>å¥½å‹å®Œæˆå…³æ³¨/ä¸‹è½½åï¼Œç³»ç»Ÿè‡ªåŠ¨ç»“ç®—</div>
                    </div>
                </div>
                
                <div class="qr-code">
                    <img src="https://qr.kuaishou.com/4713343918" alt="å¿«æ‰‹äºŒç»´ç ">
                    <p>æ‰«ç å…³æ³¨ã€æ˜Ÿçƒæ¸¸æˆã€‘å¿«æ‰‹å®˜æ–¹å·</p>
                    <p>å¿«æ‰‹å·: 4713343918</p>
                </div>
                
                <h3 style="margin-top: 20px;">æ¨å¹¿ä½œå“é“¾æ¥</h3>
                <div style="background: #f9f9f9; padding: 10px; border-radius: 5px; margin-top: 10px;">
                    <p><a href="https://v.kuaishou.com/2C2bXWB" target="_blank">https://v.kuaishou.com/2C2bXWB</a></p>
                    <p><a href="https://v.kuaishou.com/2B3koRE" target="_blank">https://v.kuaishou.com/2B3koRE</a></p>
                    <p><a href="https://v.kuaishou.com/2AKRu3o" target="_blank">https://v.kuaishou.com/2AKRu3o</a></p>
                    <p><a href="https://v.kuaishou.com/2CaQ8T7" target="_blank">https://v.kuaishou.com/2CaQ8T7</a></p>
                </div>
            </div>
            
            <div class="card">
                <h2><i class="fas fa-trophy"></i> ä»Šæ—¥èµšé’±æ¦œ</h2>
                <div class="user-list">
                    <div class="user-item">
                        <div class="user-avatar-small">å¼ *</div>
                        <div class="user-info">
                            <div>æ¨å¹¿86äººä¸‹è½½</div>
                            <div style="font-size:12px;color:#999;">2å°æ—¶å‰</div>
                        </div>
                        <div class="user-earnings">+Â¥430</div>
                    </div>
                    <div class="user-item">
                        <div class="user-avatar-small">æ*</div>
                        <div class="user-info">
                            <div>æ¨å¹¿52äººä¸‹è½½</div>
                            <div style="font-size:12px;color:#999;">1å°æ—¶å‰</div>
                        </div>
                        <div class="user-earnings">+Â¥260</div>
                    </div>
                    <div class="user-item">
                        <div class="user-avatar-small">ç‹*</div>
                        <div class="user-info">
                            <div>æ¨å¹¿38äººä¸‹è½½</div>
                            <div style="font-size:12px;color:#999;">30åˆ†é’Ÿå‰</div>
                        </div>
                        <div class="user-earnings">+Â¥190</div>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <h2><i class="fas fa-lightbulb"></i> æ¨å¹¿æŠ€å·§</h2>
                <ul>
                    <li>åˆ†äº«åˆ°å¾®ä¿¡ç¾¤ã€æœ‹å‹åœˆï¼Œé™„ä¸Šä½ çš„ä¸“å±é‚€è¯·ç </li>
                    <li>å‘Šè¯‰å¥½å‹"å…³æ³¨å°±æœ‰é’±ï¼Œä¸‹è½½èµš5å…ƒ"</li>
                    <li>æ¯å¤©åšæŒæ¨å¹¿3å°æ—¶ï¼Œæœˆå…¥3000+å¾ˆè½»æ¾</li>
                    <li>ç»„å»ºå›¢é˜Ÿï¼Œè·å¾—ä¸‹çº§20%æ”¶ç›Šåˆ†æˆ</li>
                </ul>
            </div>
            
            <button class="btn" onclick="submitTask()"><i class="fas fa-check-circle"></i> æäº¤ä»»åŠ¡å®¡æ ¸</button>
            
            <div class="card">
                <h2><i class="fas fa-info-circle"></i> æ´»åŠ¨è§„åˆ™</h2>
                <ol>
                    <li>æ”¶ç›Šæ»¡10å…ƒå¯æç°ï¼Œç§’åˆ°å¾®ä¿¡/æ”¯ä»˜å®</li>
                    <li>åŒä¸€è®¾å¤‡ä»…è®¡ç®—é¦–æ¬¡æœ‰æ•ˆ</li>
                    <li>ç¦æ­¢åˆ·é‡ï¼Œè¿è§„è€…å°å·å¤„ç†</li>
                    <li>æ´»åŠ¨æˆªæ­¢æ—¶é—´ï¼š2027å¹´6æœˆ4æ—¥</li>
                </ol>
            </div>
        </div>
        
        <!-- æˆ‘çš„æ”¶ç›Š -->
        <div id="earnings-tab" style="display: none;">
            <div class="card">
                <h2><i class="fas fa-wallet"></i> æˆ‘çš„é’±åŒ…</h2>
                <div style="text-align: center; margin: 20px 0;">
                    <div style="font-size: 14px; color: var(--light-text);">å¯æç°é‡‘é¢</div>
                    <div style="font-size: 36px; font-weight: bold; color: var(--primary-color);" id="withdrawable-amount">Â¥0.00</div>
                </div>
                
                <div class="stats-container">
                    <div class="stat-card">
                        <div class="stat-value" id="today-earnings">Â¥0</div>
                        <div class="stat-label">ä»Šæ—¥æ”¶ç›Š</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="month-earnings">Â¥0</div>
                        <div class="stat-label">æœ¬æœˆæ”¶ç›Š</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="total-earnings">Â¥0</div>
                        <div class="stat-label">ç´¯è®¡æ”¶ç›Š</div>
                    </div>
                </div>
                
                <button class="btn" onclick="showWithdrawModal()" id="withdraw-btn" disabled><i class="fas fa-money-bill-wave"></i> ç”³è¯·æç°</button>
                <div style="text-align: center; font-size: 12px; color: var(--light-text);">æç°æ—¥: æ¯æœˆ1å·å’Œ16å·</div>
            </div>
            
            <div class="card">
                <h2><i class="fas fa-chart-line"></i> æ”¶ç›Šæ˜ç»†</h2>
                <div id="earnings-details">
                    <div style="text-align: center; padding: 30px; color: var(--light-text);">
                        <i class="fas fa-wallet" style="font-size: 40px; margin-bottom: 10px;"></i>
                        <p>æš‚æ— æ”¶ç›Šè®°å½•</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- ä»»åŠ¡æäº¤ -->
        <div id="task-tab" style="display: none;">
            <div class="card">
                <h2><i class="fas fa-tasks"></i> æäº¤æ¨å¹¿ä»»åŠ¡</h2>
                <div class="form-group">
                    <label>æ¨å¹¿æ–¹å¼</label>
                    <select class="form-control" id="task-type">
                        <option value="follow">å¿«æ‰‹è´¦å·å…³æ³¨</option>
                        <option value="watch">è§†é¢‘è§‚çœ‹</option>
                        <option value="download">æ¸¸æˆä¸‹è½½</option>
                        <option value="play">æ¸¸æˆè¯•ç©</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>æ¨å¹¿äººæ•°</label>
                    <input type="number" class="form-control" id="task-count" placeholder="è¯·è¾“å…¥æ¨å¹¿äººæ•°">
                </div>
                <div class="form-group">
                    <label>æ¨å¹¿æˆªå›¾è¯æ˜</label>
                    <input type="file" class="form-control" id="task-proof" accept="image/*">
                </div>
                <div class="form-group">
                    <label>å¤‡æ³¨è¯´æ˜</label>
                    <textarea class="form-control" id="task-remark" rows="3" placeholder="å¯å¡«å†™æ¨å¹¿è¯¦æƒ…"></textarea>
                </div>
                <button class="btn" onclick="submitTask()"><i class="fas fa-paper-plane"></i> æäº¤å®¡æ ¸</button>
            </div>
            
            <div class="card">
                <h2><i class="fas fa-history"></i> ä»»åŠ¡è®°å½•</h2>
                <div id="task-history">
                    <div style="text-align: center; padding: 30px; color: var(--light-text);">
                        <i class="fas fa-history" style="font-size: 40px; margin-bottom: 10px;"></i>
                        <p>æš‚æ— ä»»åŠ¡è®°å½•</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- ç®¡ç†å‘˜é¢æ¿ -->
        <div id="admin-tab" style="display: none;">
            <div class="card">
                <h2><i class="fas fa-user-shield"></i> ç®¡ç†å‘˜é¢æ¿</h2>
                <div class="stats-container">
                    <div class="stat-card">
                        <div class="stat-value" id="admin-total-users">0</div>
                        <div class="stat-label">æ€»ç”¨æˆ·æ•°</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="admin-today-tasks">0</div>
                        <div class="stat-label">ä»Šæ—¥ä»»åŠ¡</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="admin-pending-tasks">0</div>
                        <div class="stat-label">å¾…å®¡æ ¸</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="admin-pending-withdrawals">0</div>
                        <div class="stat-label">å¾…æç°</div>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <h2><i class="fas fa-users"></i> ç”¨æˆ·ç®¡ç†</h2>
                <div class="admin-controls">
                    <input type="text" id="user-search" class="form-control" placeholder="æœç´¢ç”¨æˆ·æ‰‹æœºå·æˆ–å§“å" oninput="searchUsers()">
                </div>
                
                <div style="overflow-x: auto;">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>ç”¨æˆ·ID</th>
                                <th>æ‰‹æœºå·</th>
                                <th>å§“å</th>
                                <th>æ³¨å†Œæ—¶é—´</th>
                                <th>ç´¯è®¡æ”¶ç›Š</th>
                                <th>å¯æç°</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody id="user-list">
                            <!-- ç”¨æˆ·æ•°æ®å°†é€šè¿‡JavaScriptåŠ¨æ€åŠ è½½ -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <div class="card">
                <h2><i class="fas fa-tasks"></i> ä»»åŠ¡ç®¡ç†</h2>
                <div class="admin-controls">
                    <button class="btn" onclick="showAddTaskModal()"><i class="fas fa-plus"></i> æ·»åŠ æ–°ä»»åŠ¡</button>
                </div>
                
                <div style="overflow-x: auto;">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>ä»»åŠ¡ID</th>
                                <th>ä»»åŠ¡åç§°</th>
                                <th>ä»»åŠ¡ç±»å‹</th>
                                <th>å¥–åŠ±é‡‘é¢</th>
                                <th>ä»»åŠ¡æè¿°</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody id="admin-task-list">
                            <!-- ä»»åŠ¡æ•°æ®å°†é€šè¿‡JavaScriptåŠ¨æ€åŠ è½½ -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <div class="card">
                <h2><i class="fas fa-check-circle"></i> ä»»åŠ¡å®¡æ ¸</h2>
                <div id="task-review-list">
                    <div style="text-align: center; padding: 30px; color: var(--light-text);">
                        <i class="fas fa-check-circle" style="font-size: 40px; margin-bottom: 10px;"></i>
                        <p>æš‚æ— å¾…å®¡æ ¸ä»»åŠ¡</p>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <h2><i class="fas fa-money-bill-wave"></i> æç°ç®¡ç†</h2>
                <div style="overflow-x: auto;">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>æç°ID</th>
                                <th>ç”¨æˆ·</th>
                                <th>é‡‘é¢</th>
                                <th>æ–¹å¼</th>
                                <th>è´¦å·</th>
                                <th>ç”³è¯·æ—¶é—´</th>
                                <th>çŠ¶æ€</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody id="withdraw-review-list">
                            <!-- æç°æ•°æ®å°†é€šè¿‡JavaScriptåŠ¨æ€åŠ è½½ -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    
    <!-- æ·»åŠ ä»»åŠ¡æ¨¡æ€æ¡† -->
    <div id="add-task-modal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 1001; justify-content: center; align-items: center;">
        <div style="background: white; padding: 20px; border-radius: 10px; width: 90%; max-width: 400px;">
            <h2 style="margin-top: 0;">æ·»åŠ æ–°ä»»åŠ¡</h2>
            <div class="form-group">
                <label>ä»»åŠ¡ç±»å‹</label>
                <select class="form-control" id="new-task-type">
                    <option value="follow">å¿«æ‰‹è´¦å·å…³æ³¨</option>
                    <option value="watch">è§†é¢‘è§‚çœ‹</option>
                    <option value="download">æ¸¸æˆä¸‹è½½</option>
                    <option value="play">æ¸¸æˆè¯•ç©</option>
                </select>
            </div>
            <div class="form-group">
                <label>ä»»åŠ¡åç§°</label>
                <input type="text" class="form-control" id="new-task-name" placeholder="è¯·è¾“å…¥ä»»åŠ¡åç§°">
            </div>
            <div class="form-group">
                <label>å¥–åŠ±é‡‘é¢(å…ƒ)</label>
                <input type="number" class="form-control" id="new-task-reward" placeholder="è¯·è¾“å…¥å¥–åŠ±é‡‘é¢">
            </div>
            <div class="form-group">
                <label>ä»»åŠ¡æè¿°</label>
                <textarea class="form-control" id="new-task-desc" rows="3" placeholder="è¯·è¾“å…¥ä»»åŠ¡æè¿°"></textarea>
            </div>
            <button class="btn" onclick="addNewTask()">æ·»åŠ ä»»åŠ¡</button>
            <button style="margin-top: 10px; width: 100%; padding: 10px; background: #f0f0f0; border: none; border-radius: 5px; cursor: pointer;" onclick="hideAddTaskModal()">å–æ¶ˆ</button>
        </div>
    </div>
    
    <!-- æç°æ¨¡æ€æ¡† -->
    <div id="withdraw-modal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 1001; justify-content: center; align-items: center;">
        <div style="background: white; padding: 20px; border-radius: 10px; width: 90%; max-width: 400px;">
            <h2 style="margin-top: 0;">ç”³è¯·æç°</h2>
            <div class="form-group">
                <label>æç°é‡‘é¢</label>
                <input type="number" class="form-control" id="withdraw-amount" placeholder="è¯·è¾“å…¥æç°é‡‘é¢">
            </div>
            <div class="form-group">
                <label>æç°æ–¹å¼</label>
                <select class="form-control" id="withdraw-method">
                    <option value="wechat">å¾®ä¿¡æ”¯ä»˜</option>
                    <option value="alipay">æ”¯ä»˜å®</option>
                </select>
            </div>
            <div class="form-group">
                <label>æ”¶æ¬¾è´¦å·</label>
                <input type="text" class="form-control" id="withdraw-account" placeholder="è¯·è¾“å…¥æ”¶æ¬¾è´¦å·">
            </div>
            <div style="font-size: 12px; color: var(--light-text); margin-bottom: 15px;">
                æç°å°†åœ¨æ¯æœˆ1å·å’Œ16å·å¤„ç†ï¼Œæ‰‹ç»­è´¹2%
            </div>
            <button class="btn" onclick="submitWithdraw()">æäº¤æç°ç”³è¯·</button>
            <button style="margin-top: 10px; width: 100%; padding: 10px; background: #f0f0f0; border: none; border-radius: 5px; cursor: pointer;" onclick="hideWithdrawModal()">å–æ¶ˆ</button>
        </div>
    </div>
    
    <!-- åº•éƒ¨å¯¼èˆªæ  -->
    <div class="tab-bar">
        <div class="tab-item active" onclick="switchTab('home')">
            <i class="fas fa-home"></i>
            <span>é¦–é¡µ</span>
        </div>
        <div class="tab-item" onclick="switchTab('earnings')">
            <i class="fas fa-wallet"></i>
            <span>æˆ‘çš„æ”¶ç›Š</span>
        </div>
        <div class="tab-item" onclick="switchTab('task')">
            <i class="fas fa-tasks"></i>
            <span>ä»»åŠ¡æäº¤</span>
        </div>
        <div class="tab-item" id="admin-tab-btn" style="display: none;" onclick="switchTab('admin')">
            <i class="fas fa-user-shield"></i>
            <span>ç®¡ç†</span>
        </div>
    </div>
    
    <footer>
        <p>æ¸©é¦¨æç¤ºï¼šæ”¶ç›Šå› äººè€Œå¼‚ï¼Œå¤šåŠ³å¤šå¾—</p>
        <p>Â© 2023-2027 æ˜Ÿçƒæ¸¸æˆæ¨å¹¿å¹³å° ç‰ˆæƒæ‰€æœ‰</p>
    </footer>

    <script>
        // Firebaseé…ç½®
        const firebaseConfig = {
            apiKey: "AIzaSyDEXAMPLEEXAMPLEEXAMPLEEXAMPLE",
            authDomain: "xingshuo-game.firebaseapp.com",
            databaseURL: "https://xingshuo-game-default-rtdb.firebaseio.com",
            projectId: "xingshuo-game",
            storageBucket: "xingshuo-game.appspot.com",
            messagingSenderId: "123456789012",
            appId: "1:123456789012:web:EXAMPLEEXAMPLEEXAMPLE"
        };
        
        // åˆå§‹åŒ–Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        const auth = firebase.auth();
        
        // å½“å‰ç”¨æˆ·çŠ¶æ€
        let currentUser = null;
        let isAdmin = false;
        
        // DOMåŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            checkLoginStatus();
            updateStats();
            
            // ç›‘å¬ç”¨æˆ·æ•°æ®å˜åŒ–
            database.ref('users').on('value', (snapshot) => {
                if (isAdmin) {
                    loadAdminData();
                }
            });
            
            // ç›‘å¬ä»»åŠ¡æ•°æ®å˜åŒ–
            database.ref('tasks').on('value', (snapshot) => {
                if (isAdmin) {
                    loadAdminData();
                }
            });
            
            // ç›‘å¬æç°æ•°æ®å˜åŒ–
            database.ref('withdrawals').on('value', (snapshot) => {
                if (isAdmin) {
                    loadAdminData();
                }
            });
        });
        
        // åˆ‡æ¢æ ‡ç­¾é¡µ
        function switchTab(tabName) {
            document.querySelectorAll('.tab-item').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.getElementById('home-tab').style.display = 'none';
            document.getElementById('earnings-tab').style.display = 'none';
            document.getElementById('task-tab').style.display = 'none';
            document.getElementById('admin-tab').style.display = 'none';
            
            document.getElementById(tabName + '-tab').style.display = 'block';
            
            // æ‰¾åˆ°å¯¹åº”çš„tabæŒ‰é’®å¹¶æ¿€æ´»
            const tabBtns = document.querySelectorAll('.tab-item');
            tabBtns.forEach(btn => {
                if (btn.textContent.includes(tabName === 'home' ? 'é¦–é¡µ' : 
                                           tabName === 'earnings' ? 'æ”¶ç›Š' : 
                                           tabName === 'task' ? 'ä»»åŠ¡' : 'ç®¡ç†')) {
                    btn.classList.add('active');
                }
            });
            
            // å¦‚æœæ˜¯æ”¶ç›Šæˆ–ä»»åŠ¡é¡µï¼Œæ£€æŸ¥ç™»å½•çŠ¶æ€
            if ((tabName === 'earnings' || tabName === 'task') && !currentUser) {
                showLoginForm();
                switchTab('home');
            }
            
            // å¦‚æœæ˜¯ç®¡ç†å‘˜æ ‡ç­¾é¡µï¼ŒåŠ è½½æ•°æ®
            if (tabName === 'admin' && isAdmin) {
                loadAdminData();
            }
        }
        
        // æ˜¾ç¤º/éšè—ç”¨æˆ·èœå•
        function toggleUserMenu() {
            const menu = document.getElementById('user-menu');
            if (menu.style.display === 'block') {
                menu.style.display = 'none';
            } else {
                menu.style.display = 'block';
            }
        }
        
        // å…³é—­æ‰€æœ‰å¼¹å‡ºå±‚
        function closeAllPopups() {
            document.getElementById('user-menu').style.display = 'none';
            document.getElementById('login-modal').style.display = 'none';
            document.getElementById('admin-login-modal').style.display = 'none';
            document.getElementById('add-task-modal').style.display = 'none';
            document.getElementById('withdraw-modal').style.display = 'none';
        }
        
        // ç‚¹å‡»é¡µé¢å…¶ä»–åœ°æ–¹å…³é—­å¼¹å‡ºå±‚
        document.addEventListener('click', function(e) {
            if (!e.target.closest('#user-avatar') && !e.target.closest('#user-menu')) {
                document.getElementById('user-menu').style.display = 'none';
            }
        });
        
        // æ˜¾ç¤ºç™»å½•è¡¨å•
        function showLoginForm() {
            closeAllPopups();
            document.getElementById('login-modal').style.display = 'flex';
        }
        
        // éšè—ç™»å½•è¡¨å•
        function hideLoginForm() {
            document.getElementById('login-modal').style.display = 'none';
        }
        
        // æ˜¾ç¤ºç®¡ç†å‘˜ç™»å½•è¡¨å•
        function showAdminLogin() {
            closeAllPopups();
            document.getElementById('admin-login-modal').style.display = 'flex';
        }
        
        // éšè—ç®¡ç†å‘˜ç™»å½•è¡¨å•
        function hideAdminLogin() {
            document.getElementById('admin-login-modal').style.display = 'none';
        }
        
        // æ˜¾ç¤ºæ·»åŠ ä»»åŠ¡æ¨¡æ€æ¡†
        function showAddTaskModal() {
            document.getElementById('add-task-modal').style.display = 'flex';
        }
        
        // éšè—æ·»åŠ ä»»åŠ¡æ¨¡æ€æ¡†
        function hideAddTaskModal() {
            document.getElementById('add-task-modal').style.display = 'none';
        }
        
        // æ˜¾ç¤ºæç°æ¨¡æ€æ¡†
        function showWithdrawModal() {
            if (!currentUser) {
                showLoginForm();
                return;
            }
            
            document.getElementById('withdraw-amount').value = '';
            document.getElementById('withdraw-account').value = '';
            document.getElementById('withdraw-modal').style.display = 'flex';
        }
        
        // éšè—æç°æ¨¡æ€æ¡†
        function hideWithdrawModal() {
            document.getElementById('withdraw-modal').style.display = 'none';
        }
        
        // å‘é€éªŒè¯ç 
        document.getElementById('send-code-btn').addEventListener('click', function() {
            const phone = document.getElementById('login-phone').value;
            if (!phone || !/^1[3-9]\d{9}$/.test(phone)) {
                alert('è¯·è¾“å…¥æ­£ç¡®çš„æ‰‹æœºå·ç ');
                return;
            }
            
            this.disabled = true;
            let countdown = 60;
            this.textContent = `${countdown}ç§’åé‡è¯•`;
            
            const timer = setInterval(() => {
                countdown--;
                this.textContent = `${countdown}ç§’åé‡è¯•`;
                
                if (countdown <= 0) {
                    clearInterval(timer);
                    this.disabled = false;
                    this.textContent = 'è·å–éªŒè¯ç ';
                }
            }, 1000);
            
            // æ¨¡æ‹Ÿå‘é€éªŒè¯ç 
            alert(`éªŒè¯ç å·²å‘é€è‡³ ${phone}ï¼Œæµ‹è¯•éªŒè¯ç ä¸ºï¼š123456`);
        });
        
        // ç”¨æˆ·ç™»å½•
        function userLogin() {
            const phone = document.getElementById('login-phone').value;
            const code = document.getElementById('login-code').value;
            
            if (!phone || !code) {
                alert('è¯·è¾“å…¥æ‰‹æœºå·å’ŒéªŒè¯ç ');
                return;
            }
            
            // æµ‹è¯•éªŒè¯ç ä¸º123456
            if (code !== '123456') {
                alert('éªŒè¯ç é”™è¯¯');
                return;
            }
            
            // ä½¿ç”¨Firebaseè®¤è¯ç™»å½•
            auth.signInWithEmailAndPassword(`${phone}@xingshuo.com`, 'defaultPassword')
                .then((userCredential) => {
                    // ç™»å½•æˆåŠŸ
                    const user = userCredential.user;
                    
                    // æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å­˜åœ¨
                    database.ref('users/' + phone).once('value').then((snapshot) => {
                        if (!snapshot.exists()) {
                            // æ–°ç”¨æˆ·æ³¨å†Œ
                            const newUser = {
                                id: phone,
                                phone: phone,
                                name: 'ç”¨æˆ·' + phone.slice(-4),
                                registerTime: new Date().toISOString(),
                                earnings: 0,
                                withdrawable: 0,
                                hasLoggedIn: false
                            };
                            
                            database.ref('users/' + phone).set(newUser)
                                .then(() => {
                                    currentUser = newUser;
                                    isAdmin = false;
                                    updateUserDisplay();
                                    hideLoginForm();
                                    
                                    alert(`æ¬¢è¿åŠ å…¥æ˜Ÿçƒæ¸¸æˆæ¨å¹¿å¹³å°ï¼æ‚¨çš„é‚€è¯·ç æ˜¯ï¼š${phone}`);
                                });
                        } else {
                            // ç°æœ‰ç”¨æˆ·ç™»å½•
                            currentUser = snapshot.val();
                            isAdmin = false;
                            updateUserDisplay();
                            hideLoginForm();
                        }
                    });
                })
                .catch((error) => {
                    // å¦‚æœç”¨æˆ·ä¸å­˜åœ¨ï¼Œåˆ›å»ºæ–°ç”¨æˆ·
                    if (error.code === 'auth/user-not-found') {
                        auth.createUserWithEmailAndPassword(`${phone}@xingshuo.com`, 'defaultPassword')
                            .then(() => {
                                // åˆ›å»ºæˆåŠŸåå†æ¬¡å°è¯•ç™»å½•
                                userLogin();
                            })
                            .catch((error) => {
                                alert('ç”¨æˆ·åˆ›å»ºå¤±è´¥: ' + error.message);
                            });
                    } else {
                        alert('ç™»å½•å¤±è´¥: ' + error.message);
                    }
                });
        }
        
        // ç®¡ç†å‘˜ç™»å½•
        function adminLogin() {
            const username = document.getElementById('admin-username').value;
            const password = document.getElementById('admin-password').value;
            
            // æ£€æŸ¥ç®¡ç†å‘˜å‡­æ®
            database.ref('admins').once('value').then((snapshot) => {
                const admins = snapshot.val() || {};
                const admin = admins[username];
                
                if (admin && admin.password === password) {
                    currentUser = { name: 'ç®¡ç†å‘˜' };
                    isAdmin = true;
                    
                    updateUserDisplay();
                    hideAdminLogin();
                    
                    // æ˜¾ç¤ºç®¡ç†å‘˜æ ‡ç­¾
                    document.getElementById('admin-tab-btn').style.display = 'flex';
                    switchTab('admin');
                    
                    // åŠ è½½ç®¡ç†å‘˜æ•°æ®
                    loadAdminData();
                } else {
                    alert('ç®¡ç†å‘˜è´¦å·æˆ–å¯†ç é”™è¯¯');
                }
            });
        }
        
        // é€€å‡ºç™»å½•
        function logout() {
            auth.signOut().then(() => {
                currentUser = null;
                isAdmin = false;
                updateUserDisplay();
                switchTab('home');
                
                // éšè—ç®¡ç†å‘˜æ ‡ç­¾
                document.getElementById('admin-tab-btn').style.display = 'none';
            });
        }
        
        // æ£€æŸ¥ç™»å½•çŠ¶æ€
        function checkLoginStatus() {
            auth.onAuthStateChanged((user) => {
                if (user) {
                    // ç”¨æˆ·å·²ç™»å½•
                    const phone = user.email.split('@')[0];
                    
                    database.ref('users/' + phone).once('value').then((snapshot) => {
                        if (snapshot.exists()) {
                            currentUser = snapshot.val();
                            isAdmin = false;
                            updateUserDisplay();
                        } else {
                            // æ£€æŸ¥æ˜¯å¦æ˜¯ç®¡ç†å‘˜
                            database.ref('admins').once('value').then((adminSnapshot) => {
                                const admins = adminSnapshot.val() || {};
                                if (admins[phone]) {
                                    currentUser = { name: 'ç®¡ç†å‘˜' };
                                    isAdmin = true;
                                    updateUserDisplay();
                                    document.getElementById('admin-tab-btn').style.display = 'flex';
                                }
                            });
                        }
                    });
                } else {
                    // ç”¨æˆ·æœªç™»å½•
                    currentUser = null;
                    isAdmin = false;
                    updateUserDisplay();
                    document.getElementById('admin-tab-btn').style.display = 'none';
                }
            });
        }
        
        // æ›´æ–°ç”¨æˆ·æ˜¾ç¤º
        function updateUserDisplay() {
            if (currentUser) {
                document.getElementById('username-display').textContent = currentUser.name;
                document.getElementById('logout-btn').style.display = 'block';
                
                // æ›´æ–°æ”¶ç›Šæ•°æ®
                if (!isAdmin) {
                    updateEarningsDisplay();
                    updateTaskHistory();
                }
            } else {
                document.getElementById('username-display').textContent = 'æœªç™»å½•';
                document.getElementById('logout-btn').style.display = 'none';
            }
        }
        
        // æ›´æ–°æ”¶ç›Šæ˜¾ç¤º
        function updateEarningsDisplay() {
            if (!currentUser) return;
            
            database.ref('earnings').orderByChild('userId').equalTo(currentUser.id).once('value').then((snapshot) => {
                const earnings = snapshot.val() || {};
                const earningsArray = Object.values(earnings);
                
                // è®¡ç®—å„ç§æ”¶ç›Š
                const todayEarnings = earningsArray
                    .filter(e => new Date(e.time).toDateString() === new Date().toDateString())
                    .reduce((sum, e) => sum + e.amount, 0);
                
                const currentMonth = new Date().getMonth();
                const monthEarnings = earningsArray
                    .filter(e => new Date(e.time).getMonth() === currentMonth)
                    .reduce((sum, e) => sum + e.amount, 0);
                
                const totalEarnings = earningsArray.reduce((sum, e) => sum + e.amount, 0);
                
                document.getElementById('today-earnings').textContent = `Â¥${todayEarnings.toFixed(2)}`;
                document.getElementById('month-earnings').textContent = `Â¥${monthEarnings.toFixed(2)}`;
                document.getElementById('total-earnings').textContent = `Â¥${totalEarnings.toFixed(2)}`;
                document.getElementById('withdrawable-amount').textContent = `Â¥${currentUser.withdrawable.toFixed(2)}`;
                
                // æ›´æ–°æç°æŒ‰é’®çŠ¶æ€
                document.getElementById('withdraw-btn').disabled = currentUser.withdrawable < 10;
                
                // æ›´æ–°æ”¶ç›Šæ˜ç»†
                updateEarningsDetails(earningsArray);
            });
        }
        
        // æ›´æ–°æ”¶ç›Šæ˜ç»†
        function updateEarningsDetails(earningsArray) {
            if (earningsArray.length === 0) {
                document.getElementById('earnings-details').innerHTML = `
                    <div style="text-align: center; padding: 30px; color: var(--light-text);">
                        <i class="fas fa-wallet" style="font-size: 40px; margin-bottom: 10px;"></i>
                        <p>æš‚æ— æ”¶ç›Šè®°å½•</p>
                    </div>
                `;
                return;
            }
            
            const detailsHtml = earningsArray.map(e => `
                <div class="price-item">
                    <div>
                        <div>${e.type === 'follow' ? 'å¿«æ‰‹è´¦å·å…³æ³¨' : 
                              e.type === 'watch' ? 'è§†é¢‘è§‚çœ‹' : 
                              e.type === 'download' ? 'æ¸¸æˆä¸‹è½½' : 'æ¸¸æˆè¯•ç©'}</div>
                        <div style="font-size:12px;color:#999;">${new Date(e.time).toLocaleString()}</div>
                    </div>
                    <div class="highlight">+Â¥${e.amount.toFixed(2)}</div>
                </div>
            `).join('');
            
            document.getElementById('earnings-details').innerHTML = detailsHtml;
        }
        
        // æäº¤ä»»åŠ¡
        function submitTask() {
            if (!currentUser) {
                showLoginForm();
                return;
            }
            
            const type = document.getElementById('task-type').value;
            const count = parseInt(document.getElementById('task-count').value);
            const proof = document.getElementById('task-proof').files[0];
            const remark = document.getElementById('task-remark').value;
            
            if (!count || count <= 0) {
                alert('è¯·è¾“å…¥æœ‰æ•ˆçš„æ¨å¹¿äººæ•°');
                return;
            }
            
            if (!proof) {
                alert('è¯·ä¸Šä¼ æ¨å¹¿æˆªå›¾è¯æ˜');
                return;
            }
            
            // è·å–ä»»åŠ¡å¥–åŠ±æ ‡å‡†
            database.ref('tasks').once('value').then((snapshot) => {
                const tasks = snapshot.val() || {};
                const task = Object.values(tasks).find(t => t.type === type);
                
                if (!task) {
                    alert('ä»»åŠ¡ç±»å‹é”™è¯¯');
                    return;
                }
                
                // åˆ›å»ºç”¨æˆ·ä»»åŠ¡è®°å½•
                const newTask = {
                    id: Date.now().toString(),
                    userId: currentUser.id,
                    taskId: task.id,
                    type: task.type,
                    count: count,
                    status: 'pending',
                    proof: 'å·²ä¸Šä¼ ', // å®é™…åº”ç”¨ä¸­åº”è¯¥ä¸Šä¼ åˆ°æœåŠ¡å™¨
                    remark: remark,
                    submitTime: new Date().toISOString(),
                    reward: task.reward * count
                };
                
                database.ref('userTasks/' + newTask.id).set(newTask)
                    .then(() => {
                        // æ¸…ç©ºè¡¨å•
                        document.getElementById('task-count').value = '';
                        document.getElementById('task-proof').value = '';
                        document.getElementById('task-remark').value = '';
                        
                        alert('ä»»åŠ¡å·²æäº¤ï¼Œç­‰å¾…ç®¡ç†å‘˜å®¡æ ¸');
                        
                        // æ›´æ–°ä»»åŠ¡å†å²
                        updateTaskHistory();
                    });
            });
        }
        
        // æ›´æ–°ä»»åŠ¡å†å²
        function updateTaskHistory() {
            if (!currentUser) return;
            
            database.ref('userTasks').orderByChild('userId').equalTo(currentUser.id).once('value').then((snapshot) => {
                const userTasks = snapshot.val() || {};
                const tasksArray = Object.values(userTasks);
                
                database.ref('tasks').once('value').then((taskSnapshot) => {
                    const tasks = taskSnapshot.val() || {};
                    
                    if (tasksArray.length === 0) {
                        document.getElementById('task-history').innerHTML = `
                            <div style="text-align: center; padding: 30px; color: var(--light-text);">
                                <i class="fas fa-history" style="font-size: 40px; margin-bottom: 10px;"></i>
                                <p>æš‚æ— ä»»åŠ¡è®°å½•</p>
                            </div>
                        `;
                        return;
                    }
                    
                    const historyHtml = tasksArray.map(t => {
                        const task = Object.values(tasks).find(task => task.id === t.taskId);
                        return `
                            <div class="task-item">
                                <div>
                                    <div><strong>${task ? task.name : 'æœªçŸ¥ä»»åŠ¡'}</strong> Ã— ${t.count}</div>
                                    <div style="font-size:12px;color:#999;">${new Date(t.submitTime).toLocaleString()}</div>
                                    <div style="font-size:12px;">
                                        çŠ¶æ€: <span style="color: ${
                                            t.status === 'approved' ? 'green' : 
                                            t.status === 'rejected' ? 'red' : 'orange'
                                        };">${
                                            t.status === 'approved' ? 'å·²é€šè¿‡' : 
                                            t.status === 'rejected' ? 'å·²æ‹’ç»' : 'å¾…å®¡æ ¸'
                                        }</span>
                                    </div>
                                </div>
                                <div class="user-earnings">Â¥${t.reward.toFixed(2)}</div>
                            </div>
                        `;
                    }).join('');
                    
                    document.getElementById('task-history').innerHTML = historyHtml;
                });
            });
        }
        
        // æ·»åŠ æ–°ä»»åŠ¡
        function addNewTask() {
            const type = document.getElementById('new-task-type').value;
            const name = document.getElementById('new-task-name').value;
            const reward = parseFloat(document.getElementById('new-task-reward').value);
            const desc = document.getElementById('new-task-desc').value;
            
            if (!name || !reward || reward <= 0 || !desc) {
                alert('è¯·å¡«å†™å®Œæ•´çš„ä»»åŠ¡ä¿¡æ¯');
                return;
            }
            
            const newTask = {
                id: Date.now().toString(),
                type: type,
                name: name,
                reward: reward,
                desc: desc
            };
            
            database.ref('tasks/' + newTask.id).set(newTask)
                .then(() => {
                    alert('ä»»åŠ¡æ·»åŠ æˆåŠŸ');
                    hideAddTaskModal();
                    loadAdminData();
                });
        }
        
        // æäº¤æç°ç”³è¯·
        function submitWithdraw() {
            const amount = parseFloat(document.getElementById('withdraw-amount').value);
            const method = document.getElementById('withdraw-method').value;
            const account = document.getElementById('withdraw-account').value;
            
            if (!amount || amount <= 0 || !account) {
                alert('è¯·è¾“å…¥æœ‰æ•ˆçš„æç°é‡‘é¢å’Œæ”¶æ¬¾è´¦å·');
                return;
            }
            
            if (amount > currentUser.withdrawable) {
                alert('æç°é‡‘é¢ä¸èƒ½è¶…è¿‡å¯æç°ä½™é¢');
                return;
            }
            
            // åˆ›å»ºæç°è®°å½•
            const newWithdrawal = {
                id: Date.now().toString(),
                userId: currentUser.id,
                amount: amount,
                method: method,
                account: account,
                status: 'pending',
                applyTime: new Date().toISOString(),
                fee: amount * 0.02
            };
            
            database.ref('withdrawals/' + newWithdrawal.id).set(newWithdrawal)
                .then(() => {
                    // æ›´æ–°ç”¨æˆ·å¯æç°ä½™é¢
                    database.ref('users/' + currentUser.id).update({
                        withdrawable: currentUser.withdrawable - amount
                    }).then(() => {
                        // æ›´æ–°å½“å‰ç”¨æˆ·å¯¹è±¡
                        currentUser.withdrawable -= amount;
                        updateUserDisplay();
                        
                        alert('æç°ç”³è¯·å·²æäº¤ï¼Œå°†åœ¨æ¯æœˆ1å·å’Œ16å·å¤„ç†');
                        hideWithdrawModal();
                    });
                });
        }
        
        // åŠ è½½ç®¡ç†å‘˜æ•°æ®
        function loadAdminData() {
            // ç”¨æˆ·ç»Ÿè®¡
            database.ref('users').once('value').then((snapshot) => {
                const users = snapshot.val() || {};
                document.getElementById('admin-total-users').textContent = Object.keys(users).length;
                
                // åŠ è½½ç”¨æˆ·åˆ—è¡¨
                loadUserList(users);
            });
            
            // ä»»åŠ¡ç»Ÿè®¡
            database.ref('userTasks').once('value').then((snapshot) => {
                const userTasks = snapshot.val() || {};
                const tasksArray = Object.values(userTasks);
                
                const todayTasks = tasksArray.filter(t => 
                    new Date(t.submitTime).toDateString() === new Date().toDateString());
                
                document.getElementById('admin-today-tasks').textContent = todayTasks.length;
                
                const pendingTasks = tasksArray.filter(t => t.status === 'pending');
                document.getElementById('admin-pending-tasks').textContent = pendingTasks.length;
                
                // åŠ è½½å¾…å®¡æ ¸ä»»åŠ¡
                loadPendingTasks(pendingTasks);
            });
            
            // åŠ è½½ä»»åŠ¡åˆ—è¡¨
            database.ref('tasks').once('value').then((snapshot) => {
                const tasks = snapshot.val() || {};
                loadTaskList(tasks);
            });
            
            // åŠ è½½æç°ç»Ÿè®¡
            database.ref('withdrawals').once('value').then((snapshot) => {
                const withdrawals = snapshot.val() || {};
                const withdrawalsArray = Object.values(withdrawals);
                
                const pendingWithdrawals = withdrawalsArray.filter(w => w.status === 'pending');
                document.getElementById('admin-pending-withdrawals').textContent = pendingWithdrawals.length;
                
                // åŠ è½½æç°åˆ—è¡¨
                loadWithdrawalList(withdrawals);
            });
        }
        
        // åŠ è½½ç”¨æˆ·åˆ—è¡¨
        function loadUserList(users) {
            const usersArray = Object.values(users);
            
            const userListHtml = usersArray.map(user => `
                <tr>
                    <td>${user.id}</td>
                    <td>${user.phone}</td>
                    <td>${user.name}</td>
                    <td>${new Date(user.registerTime).toLocaleDateString()}</td>
                    <td>Â¥${user.earnings ? user.earnings.toFixed(2) : '0.00'}</td>
                    <td>Â¥${user.withdrawable ? user.withdrawable.toFixed(2) : '0.00'}</td>
                    <td>
                        <button onclick="editUser('${user.id}')" class="edit-btn"><i class="fas fa-edit"></i></button>
                    </td>
                </tr>
            `).join('');
            
            document.getElementById('user-list').innerHTML = userListHtml;
        }
        
        // æœç´¢ç”¨æˆ·
        function searchUsers() {
            const searchTerm = document.getElementById('user-search').value.toLowerCase();
            
            database.ref('users').once('value').then((snapshot) => {
                const users = snapshot.val() || {};
                const filteredUsers = Object.values(users).filter(user => 
                    user.phone.toLowerCase().includes(searchTerm) || 
                    user.name.toLowerCase().includes(searchTerm));
                
                loadUserList(filteredUsers);
            });
        }
        
        // åŠ è½½ä»»åŠ¡åˆ—è¡¨
        function loadTaskList(tasks) {
            const tasksArray = Object.values(tasks);
            
            const taskListHtml = tasksArray.map(task => `
                <tr>
                    <td>${task.id}</td>
                    <td>${task.name}</td>
                    <td>${task.type === 'follow' ? 'å…³æ³¨' : 
                         task.type === 'watch' ? 'è§‚çœ‹' : 
                         task.type === 'download' ? 'ä¸‹è½½' : 'è¯•ç©'}</td>
                    <td>Â¥${task.reward.toFixed(2)}</td>
                    <td>${task.desc}</td>
                    <td>
                        <button onclick="editTask('${task.id}')" class="edit-btn"><i class="fas fa-edit"></i></button>
                        <button onclick="deleteTask('${task.id}')" class="delete-btn"><i class="fas fa-trash"></i></button>
                    </td>
                </tr>
            `).join('');
            
            document.getElementById('admin-task-list').innerHTML = taskListHtml;
        }
        
        // åŠ è½½å¾…å®¡æ ¸ä»»åŠ¡
        function loadPendingTasks(pendingTasks) {
            if (pendingTasks.length === 0) {
                document.getElementById('task-review-list').innerHTML = `
                    <div style="text-align: center; padding: 30px; color: var(--light-text);">
                        <i class="fas fa-check-circle" style="font-size: 40px; margin-bottom: 10px;"></i>
                        <p>æš‚æ— å¾…å®¡æ ¸ä»»åŠ¡</p>
                    </div>
                `;
                return;
            }
            
            database.ref('users').once('value').then((userSnapshot) => {
                const users = userSnapshot.val() || {};
                
                database.ref('tasks').once('value').then((taskSnapshot) => {
                    const tasks = taskSnapshot.val() || {};
                    
                    const tasksHtml = pendingTasks.map(t => {
                        const user = users[t.userId];
                        const task = Object.values(tasks).find(task => task.id === t.taskId);
                        
                        return `
                            <div class="card" style="margin-bottom: 10px;">
                                <div style="display: flex; justify-content: space-between;">
                                    <div>
                                        <strong>${user ? user.name : 'æœªçŸ¥ç”¨æˆ·'}</strong>
                                        <div style="font-size: 12px; color: var(--light-text);">
                                            ${new Date(t.submitTime).toLocaleString()}
                                        </div>
                                    </div>
                                    <div class="highlight">Â¥${t.reward.toFixed(2)}</div>
                                </div>
                                <div style="margin-top: 10px;">
                                    <div><strong>${task ? task.name : 'æœªçŸ¥ä»»åŠ¡'}</strong> Ã— ${t.count}</div>
                                    <div style="font-size: 12px; margin-top: 5px;">${t.remark || 'æ— å¤‡æ³¨'}</div>
                                </div>
                                <div style="margin-top: 10px; display: flex; justify-content: space-between;">
                                    <button onclick="reviewTask('${t.id}', 'approved')" style="padding: 5px 15px; background: #28a745; color: white; border: none; border-radius: 5px; cursor: pointer;">é€šè¿‡</button>
                                    <button onclick="reviewTask('${t.id}', 'rejected')" style="padding: 5px 15px; background: #dc3545; color: white; border: none; border-radius: 5px; cursor: pointer;">æ‹’ç»</button>
                                </div>
                            </div>
                        `;
                    }).join('');
                    
                    document.getElementById('task-review-list').innerHTML = tasksHtml;
                });
            });
        }
        
        // å®¡æ ¸ä»»åŠ¡
        function reviewTask(taskId, status) {
            database.ref('userTasks/' + taskId).once('value').then((snapshot) => {
                const task = snapshot.val();
                
                if (!task) return;
                
                // æ›´æ–°ä»»åŠ¡çŠ¶æ€
                database.ref('userTasks/' + taskId).update({
                    status: status,
                    reviewTime: new Date().toISOString()
                }).then(() => {
                    // å¦‚æœå®¡æ ¸é€šè¿‡ï¼Œç»™ç”¨æˆ·æ·»åŠ æ”¶ç›Š
                    if (status === 'approved') {
                        // åˆ›å»ºæ”¶ç›Šè®°å½•
                        const newEarning = {
                            id: Date.now().toString(),
                            userId: task.userId,
                            type: task.type,
                            amount: task.reward,
                            time: new Date().toISOString(),
                            taskId: task.id
                        };
                        
                        database.ref('earnings/' + newEarning.id).set(newEarning);
                        
                        // æ›´æ–°ç”¨æˆ·å¯æç°ä½™é¢
                        database.ref('users/' + task.userId).once('value').then((userSnapshot) => {
                            const user = userSnapshot.val();
                            if (user) {
                                const newWithdrawable = (user.withdrawable || 0) + task.reward;
                                database.ref('users/' + task.userId).update({
                                    withdrawable: newWithdrawable
                                });
                            }
                        });
                    }
                    
                    // é‡æ–°åŠ è½½æ•°æ®
                    loadAdminData();
                });
            });
        }
        
        // åŠ è½½æç°åˆ—è¡¨
        function loadWithdrawalList(withdrawals) {
            database.ref('users').once('value').then((userSnapshot) => {
                const users = userSnapshot.val() || {};
                const withdrawalsArray = Object.values(withdrawals);
                
                const withdrawalListHtml = withdrawalsArray.map(w => {
                    const user = users[w.userId];
                    
                    return `
                        <tr>
                            <td>${w.id}</td>
                            <td>${user ? user.name : 'æœªçŸ¥ç”¨æˆ·'}</td>
                            <td>Â¥${w.amount.toFixed(2)}</td>
                            <td>${w.method === 'wechat' ? 'å¾®ä¿¡' : 'æ”¯ä»˜å®'}</td>
                            <td>${w.account}</td>
                            <td>${new Date(w.applyTime).toLocaleDateString()}</td>
                            <td>
                                <span class="withdraw-status ${'status-' + w.status}">
                                    ${w.status === 'pending' ? 'å¾…å¤„ç†' : 
                                     w.status === 'success' ? 'å·²å®Œæˆ' : 'å¤±è´¥'}
                                </span>
                            </td>
                            <td>
                                ${w.status === 'pending' ? `
                                    <button onclick="processWithdrawal('${w.id}', 'success')" class="edit-btn"><i class="fas fa-check"></i></button>
                                    <button onclick="processWithdrawal('${w.id}', 'failed')" class="delete-btn"><i class="fas fa-times"></i></button>
                                ` : ''}
                            </td>
                        </tr>
                    `;
                }).join('');
                
                document.getElementById('withdraw-review-list').innerHTML = withdrawalListHtml;
            });
        }
        
        // å¤„ç†æç°
        function processWithdrawal(withdrawalId, status) {
            database.ref('withdrawals/' + withdrawalId).update({
                status: status,
                processTime: new Date().toISOString()
            }).then(() => {
                // å¦‚æœæç°å¤±è´¥ï¼Œè¿”è¿˜é‡‘é¢ç»™ç”¨æˆ·
                if (status === 'failed') {
                    database.ref('withdrawals/' + withdrawalId).once('value').then((snapshot) => {
                        const withdrawal = snapshot.val();
                        
                        database.ref('users/' + withdrawal.userId).once('value').then((userSnapshot) => {
                            const user = userSnapshot.val();
                            if (user) {
                                const newWithdrawable = (user.withdrawable || 0) + withdrawal.amount;
                                database.ref('users/' + withdrawal.userId).update({
                                    withdrawable: newWithdrawable
                                });
                            }
                        });
                    });
                }
                
                // é‡æ–°åŠ è½½æç°åˆ—è¡¨
                loadAdminData();
            });
        }
        
        // ç¼–è¾‘ç”¨æˆ·
        function editUser(userId) {
            // è¿™é‡Œå¯ä»¥å®ç°ç¼–è¾‘ç”¨æˆ·çš„åŠŸèƒ½
            alert('ç¼–è¾‘ç”¨æˆ·åŠŸèƒ½: ' + userId);
        }
        
        // ç¼–è¾‘ä»»åŠ¡
        function editTask(taskId) {
            // è¿™é‡Œå¯ä»¥å®ç°ç¼–è¾‘ä»»åŠ¡çš„åŠŸèƒ½
            alert('ç¼–è¾‘ä»»åŠ¡åŠŸèƒ½: ' + taskId);
        }
        
        // åˆ é™¤ä»»åŠ¡
        function deleteTask(taskId) {
            if (confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªä»»åŠ¡å—ï¼Ÿ')) {
                database.ref('tasks/' + taskId).remove()
                    .then(() => {
                        alert('ä»»åŠ¡åˆ é™¤æˆåŠŸ');
                        loadAdminData();
                    });
            }
        }
        
        // æ›´æ–°ç»Ÿè®¡æ•°æ®
        function updateStats() {
            // æ¨¡æ‹Ÿæ›´æ–°ä»Šæ—¥å‚ä¸äººæ•°å’Œæœ€é«˜æ”¶ç›Š
            document.getElementById('today-users').textContent = Math.floor(Math.random() * 100) + 200;
            document.getElementById('max-earnings').textContent = Math.floor(Math.random() * 200) + 200;
        }
    </script>
</body>
</html>
